function slice(c,b,a){return Array.prototype.slice.call(c,b,a)}function keys(a){return Object.keys(a)}function Strace(){this.strace=[]}Strace.prototype.push=function(a){this.strace.push(a);return this.strace.length-1};Strace.prototype.pop=function(a){while(this.strace.length>a){this.strace.pop()}return this.strace.length};Strace.prototype.clear=function(){this.strace=[]};Strace.prototype.willstrace=function(){var e=arguments.length==2?arguments[0]:"";var d=arguments.length==2?arguments[1]:arguments[0];var c;var b=this;return function a(){var f;f=b.push(e+this);c=d.apply(this,arguments);b.pop(f);return c}};Strace.prototype.unwindstrace=function(c){var b,a=this;return function d(){try{b=c.apply(this,arguments)}catch(e){a.print();throw e}return b}};Strace.prototype.print=function(){var b,a;for(b="lisa trace:\n",a=0;a<this.strace.length;a++){b+="    "+a+": "+this.strace[a]+"\n"}console.log(b)};var strace=new Strace();var stracedb=new Strace();function Unique(){}function NameGenerator(a){this.source=a;this.index=0}NameGenerator.prototype.generate=function(){var b="";var a=this.index++;var c=this.source;do{b+=c[a%c.length];a=a/c.length|0}while(a);return b};function NameGeneratorIgnore(a,b){this.source=a;this.index=0;this.ignores=b}NameGeneratorIgnore.prototype.generate=function(){var a;while(this.ignores.indexOf((a=NameGenerator.prototype.generate.call(this)))>=0){}return a};function Constantable(){}Constantable.prototype.constantable=false;Constantable.prototype.constant=function(){this.constantable=true;return this};Constantable.prototype.notconstant=function(){this.constantable=false;return this};Constantable.prototype.inherit=function(a){this.constantable=a.isconstant();return this};Constantable.prototype.isconstant=function(){return this.constantable};Constantable.prototype.isnotconstant=function(){return this.isconstant()==false};function Evaluatable(){}Evaluatable.prototype=Object.create(Constantable.prototype);Evaluatable.prototype.onevaluate=null;Evaluatable.prototype.onevaluatearg=null;Evaluatable.prototype.onevaluatedata=null;function evaluate(a){if(a instanceof Evaluatable==false){throw new Error(""+a+" is not evaluatable")}return a.evaluate.apply(a,arguments)}function evaluatearg(a){if(a instanceof Evaluatable==false){throw new Error(""+a+" is not evaluatable")}return a.evaluatearg.apply(a,arguments)}function evaluatedata(a){if(a instanceof Evaluatable==false){throw new Error(""+a+" is not evaluatable")}return a.evaluatedata.apply(a,arguments)}function beforeevaluate(b){return function a(){return b.apply(this,slice(arguments).map(evaluate))}}function beforeevaluatearg(b){return function a(){return b.apply(this,slice(arguments).map(evaluatearg))}}function beforeevaluatedata(a){return function b(){return a.apply(this,slice(arguments).map(evaluatedata))}}function afterevaluate(a){return function b(){return a.apply(this,arguments).evaluate()}}function afterevaluatearg(b){return function a(){return b.apply(this,arguments).evaluatearg()}}function afterevaluatedata(b){return function a(){return b.apply(this,slice(arguments).map(evaluatedata))}}Evaluatable.prototype.evaluate=function(){if(this.onevaluate==null){throw new Error(""+this+" onevaluate was not defined.")}return this.onevaluate.apply(this,arguments)};Evaluatable.prototype.evaluatearg=function(){if(this.onevaluatearg==null){throw new Error(""+this+" onevaluatearg was not defined.")}return this.onevaluatearg()};Evaluatable.prototype.evaluate=strace.willstrace("evaluate <- ",Evaluatable.prototype.evaluate);Evaluatable.prototype.evaluatedata=function(){if(this.onevaluatedata==null){return this.evaluatearg()}return this.onevaluatedata()};Evaluatable.prototype.willevaluate=function(){var a=this;return function b(){return a.evaluate.apply(a,arguments)}};Evaluatable.prototype.willevaluatearg=function(){var a=this;return function b(){return a.evaluatearg.apply(a,arguments)}};function Expandable(){}Expandable.prototype=Object.create(Evaluatable.prototype);Expandable.prototype.onexpand=null;Expandable.prototype.onexpandarg=null;Expandable.prototype.onexpanddata=null;function expand(a){if(a instanceof Expandable==false){throw new Error(""+a+" is not expandable")}return a.expand.apply(a,arguments)}function expandarg(a){if(a instanceof Expandable==false){throw new Error(""+a+" is not expandable")}return a.expandarg.apply(a,arguments)}function expanddata(a){if(a instanceof Expandable==false){throw new Error(""+a+" is not expandable")}return a.expanddata.apply(a,arguments)}function beforeexpand(a){return function b(){return a.apply(this,slice(arguments).map(expand))}}function beforeexpandarg(a){return function b(){return a.apply(this,slice(arguments).map(expandarg))}}function beforeexpanddata(a){return function b(){return a.apply(this,slice(arguments).map(expanddata))}}function afterexpand(a){return function b(){return a.apply(this,arguments).expand()}}function afterexpandarg(a){return function b(){return a.apply(this,arguments).expandarg()}}function afterexpanddata(b){return function a(){return b.apply(this,arguments).expanddata()}}Expandable.prototype.expand=function(){if(this.onexpand==null){throw new Error(""+this+" onexpand was not defined.")}return this.onexpand.apply(this,arguments)};Expandable.prototype.expandarg=function(){if(this.onexpandarg==null){throw new Error(""+this+"onexpandarg was not defined.")}return this.onexpandarg()};Expandable.prototype.expanddata=function(){if(this.onexpanddata==null){return this.expandarg()}return this.onexpanddata()};Expandable.prototype.willexpand=function(){var b=this;return function a(){return b.expand.apply(b,arguments)}};Expandable.prototype.willexpandarg=function(){var a=this;return function b(){return a.expandarg.apply(a,arguments)}};Expandable.prototype.willexpanddata=function(){var b=this;return function a(){return b.expanddata.apply(b,arguments)}};function Expanded(a){this.value=a||""}Expanded.prototype=Object.create(Expandable.prototype);Expanded.prototype.toString=function(){return this.value};Expanded.prototype.expand=function(){return new Expanded(this.value+"("+slice(arguments).map(expandarg).join(",")+")")};Expanded.prototype.onevaluatearg=function(){return this};Expanded.prototype.onexpandarg=function(){return this};Expanded.prototype.unpack=function(){return this.value};function unpack(a){if(a instanceof Expanded==false){throw new Error("some is not expanded.")}return a.unpack()}function AtomClass(a){this.value=a}AtomClass.prototype=Object.create(Expandable.prototype);AtomClass.prototype.toString=function(){return this.value.toString()};AtomClass.prototype.toLisp=function(){return this.toString()};AtomClass.prototype.valueOf=function(){return this.toString()};AtomClass.prototype.onevaluatearg=function(){return this};AtomClass.prototype.onevaluatedata=function(){return this};AtomClass.prototype.onexpandarg=function(){return new Expanded(this.toString())};AtomClass.prototype.status=function(){return true};AtomClass.prototype.clone=function(){return this};function value(a){if(a instanceof AtomClass==false){throw new Error(""+a+" is not atom class.")}return a.value}function tostring(a){if(a instanceof AtomClass==false){throw new Error(""+a+" is not atom class.")}return a.toString()}function tolisp(a){if(a instanceof AtomClass==false){throw new Error(""+a+" is not atom class.")}return a.toLisp()}function clone(a){if(a instanceof AtomClass==false){throw new Error(""+a+" is not atom class.")}return a.clone()}function beforeclone(b){return function a(){return b.apply(b,slice(arguments).map(clone))}}function afterclone(b){return function a(){return b.apply(b,arguments).clone()}}function TrueClass(){}TrueClass.prototype=Object.create(AtomClass.prototype);TrueClass.prototype.toString=function(){return"true"};TrueClass.prototype.toLisp=function(){return"t"};TrueClass.prototype.status=function(){return true};var t=new TrueClass();function ReferenceClass(){}ReferenceClass.prototype=Object.create(AtomClass.prototype);ReferenceClass.prototype.toString=function(){return this.get().toString()};ReferenceClass.prototype.get=function(){throw new Error("get has not defined yet.")};ReferenceClass.prototype.set=function(){throw new Error("set has not defined yet.")};ReferenceClass.prototype.onevaluatearg=function(){return this.get().evaluatearg()};ReferenceClass.prototype.onexpandarg=function(){throw new Error("onexpandarg has not defined yet.")};ReferenceClass.prototype.onevaluate=null;ReferenceClass.prototype.onexpand=null;function getreference(a){return a instanceof ReferenceClass?a.get():a}function beforegetreference(b){return function a(){return b.apply(this,slice(arguments).map(getreference))}}function aftergetreference(a){return function b(){return getreference(a.apply(this,arguments))}}function ArrayReferenceClass(b,a){this.value=b||null;this.index=a}ArrayReferenceClass.prototype=Object.create(ReferenceClass.prototype);ArrayReferenceClass.prototype.get=function(){return this.value.evaluatedata().get(this.index)};ArrayReferenceClass.prototype.set=function(a){return this.value.evaluatedata().set(this.index,a)};ArrayReferenceClass.prototype.onexpanddata=function(){return new Expanded(this.value.expanddata().unpack()+"["+this.index+"]")};function ConsReferenceClass(a){this.cons=a||null}ConsReferenceClass.prototype=Object.create(ReferenceClass.prototype);ConsReferenceClass.prototype.get=function(){return this.cons};ConsReferenceClass.prototype.getcar=function(){return this.get().getcar()};ConsReferenceClass.prototype.getcdr=function(){return this.get().getcdr()};ConsReferenceClass.prototype.setcar=function(a){return this.get().setcar(a)};ConsReferenceClass.prototype.setcdr=function(a){return this.get().setcdr(a)};ConsReferenceClass.prototype.getcar=function(){return this.get().getcar()};ConsReferenceClass.prototype.getcdr=function(){return this.get().getcdr()};function makeconsreference(a){return new ConsReferenceClass(a)}function ConsCarReferenceClass(a){ConsReferenceClass.apply(this,arguments)}ConsCarReferenceClass.prototype=Object.create(ConsReferenceClass.prototype);ConsCarReferenceClass.prototype.get=function(){return this.cons.getcar()};ConsCarReferenceClass.prototype.set=function(a){return this.cons.setcar(a)};function makeconscarreference(a){return new ConsCarReferenceClass(a)}function ConsCdrReferenceClass(){ConsReferenceClass.apply(this,arguments)}ConsCdrReferenceClass.prototype=Object.create(ConsReferenceClass.prototype);ConsCdrReferenceClass.prototype.get=function(){return this.cons.getcdr()};ConsCdrReferenceClass.prototype.set=function(a){return this.cons.setcdr(a)};function makeconscdrreference(a){return new ConsCdrReferenceClass(a)}function SymbolReferenceClass(a){this.value=a}SymbolReferenceClass.prototype=Object.create(ReferenceClass.prototype);function SymbolValueReferenceClass(){SymbolReferenceClass.apply(this,arguments)}SymbolValueReferenceClass.prototype=Object.create(SymbolReferenceClass.prototype);SymbolValueReferenceClass.prototype.get=function(){return this.value.getvalue()};SymbolValueReferenceClass.prototype.set=function(a){return this.value.setvalue(a)};SymbolValueReferenceClass.prototype.onexpandarg=function(){return new Expanded(this.value.getvaluename())};function SymbolFunctionReferenceClass(){SymbolReferenceClass.apply(this,arguments)}SymbolFunctionReferenceClass.prototype=Object.create(SymbolReferenceClass.prototype);SymbolFunctionReferenceClass.prototype.get=function(){return this.value.getfunc()};SymbolFunctionReferenceClass.prototype.set=function(a){return this.value.setfunc(a)};SymbolFunctionReferenceClass.prototype.onexpandarg=function(){return new Expanded(this.value.getfuncname())};function NumberClass(a){this.value=a}NumberClass.prototype=Object.create(AtomClass.prototype);NumberClass.prototype.clone=function(){return new NumberClass(this.value)};function FloatClass(a){this.value=a}FloatClass.prototype=Object.create(NumberClass.prototype);FloatClass.prototype.clone=function(){return new FloatClass(this.value)};function makefloat(a){return new FloatClass(a)}function IntClass(a){this.value=a}IntClass.prototype=Object.create(NumberClass.prototype);IntClass.prototype.clone=function(){return new IntClass(this.value)};function makeint(a){return new IntClass(a)}function CharClass(a){this.value=a}CharClass.prototype=Object.create(IntClass.prototype);CharClass.prototype.toString=function(){return String.fromCharCode(this.value)};CharClass.prototype.toLisp=function(){return"?"+String.fromCharCode(this.value)};CharClass.prototype.clone=function(){return new CharClass(this.value)};CharClass.prototype.add=function(a){if(a instanceof IntClass==false){throw new Error("num "+a+" is not int class.")}return new CharClass(this.value+a.value)};CharClass.prototype.sub=function(a){if(a instanceof IntClass==false){throw new Error("num "+a+" is not int class.")}return new CharClass(this.value-a.value)};CharClass.prototype.mul=function(a){if(a instanceof IntClass==false){throw new Error("num "+a+" is not int class.")}return new CharClass(this.value*a.value)};CharClass.prototype.div=function(a){if(a instanceof IntClass==false){throw new Error("num "+a+" is not int class.")}return new CharClass(this.value/a.value)};CharClass.prototype.mod=function(a){if(a instanceof IntClass==false){throw new Error("num "+a+" is not int class.")}return new CharClass(this.value%a.value)};function atoi(a){return a.charCodeAt()}function atoc(a){return new CharClass(atoi(a))}function SequencialClass(){}SequencialClass.prototype=Object.create(AtomClass.prototype);SequencialClass.prototype.get=function(){throw new Error("get was not defined.")};SequencialClass.prototype.set=function(){throw new Error("set was not defined.")};SequencialClass.prototype.toArray=function(){throw new Error("toArray was not defined.")};SequencialClass.prototype.toPlain=function(){throw new Error("toPlain was not defined.")};SequencialClass.prototype.every=function(){throw new Error("every was not defined.")};SequencialClass.prototype.map=function(){throw new Error("map was not defined.")};SequencialClass.prototype.filter=function(){throw new Error("filter was not defined.")};SequencialClass.prototype.reduce=function(){throw new Error("reduce was not defined.")};SequencialClass.prototype.findif=function(){throw new Error("findif was not defined.")};SequencialClass.prototype.positionif=function(){throw new Error("positionif was not defined.")};SequencialClass.prototype.reverse=function(){throw new Error("reverse was not defined.")};SequencialClass.prototype.concat=function(){throw new Error("concat was not defined.")};SequencialClass.prototype.slice=function(){throw new Error("slice was not defined.")};SequencialClass.prototype.copy=function(){throw new Error("clone was not defined.")};SequencialClass.prototype.nth=function(){throw new Error("nth was not defined.")};SequencialClass.prototype.last=function(){throw new Error("last was not defined.")};SequencialClass.prototype.length=function(){throw new Error("length was not defined.")};SequencialClass.prototype.iter=function(){throw new Error("iter was not defined.")};SequencialClass.prototype.push=function(){throw new Error("push was not defined.")};SequencialClass.prototype.pop=function(){throw new Error("pop was not defined.")};function ArrayClass(a){this.value=a}ArrayClass.prototype=Object.create(SequencialClass.prototype);ArrayClass.prototype.get=function(a){return this.value[a]};ArrayClass.prototype.set=function(a,b){this.value[a]=b;return b};ArrayClass.prototype.toArray=function(){return this.value};ArrayClass.prototype.toPlain=function(){return this.value.join(",")};ArrayClass.prototype.every=function(a){this.value.every(a.willevaluate);return nil};ArrayClass.prototype.map=function(a){return new ArrayClass(this.value.map(a.willevaluate()))};ArrayClass.prototype.filter=function(a){return new ArrayClass(this.value.filter(a.willevaluate()))};ArrayClass.prototype.reduce=function(a){return this.value.reduce(a.willevaluate())};ArrayClass.prototype.findif=function(b){var a,c;for(c=null,a=0;a<this.length();a++){if((c=this.nth(a)).status()){return c}}return nil};ArrayClass.prototype.positionif=function(c){var a,b;for(b=0,a=0;a<this.length();a++,b++){if(this.nth(a).status()){return b}}return nil};ArrayClass.prototype.nth=function(a){return new ArrayReferenceClass(this,a)};ArrayClass.prototype.last=function(){return this.length()==0?nil:this.nth(this.length()-1)};ArrayClass.prototype.length=function(){return this.value.length};ArrayClass.prototype.reverse=function(){this.value.reverse();return this};ArrayClass.prototype.copy=function(){return new ArrayClass(this.value.slice())};ArrayClass.prototype.push=function(a){return this.value.push(a)};ArrayClass.prototype.pop=function(){return this.value.pop()};function ClassArrayClass(b,a){this.value=b;this.classe=a}ClassArrayClass.prototype=Object.create(ArrayClass.prototype);function StringClass(a){this.value=a||[]}StringClass.prototype=Object.create(ClassArrayClass.prototype);StringClass.prototype.onevaluate=null;StringClass.prototype.onexpand=null;StringClass.prototype.onevaluatearg=function(){return this};StringClass.prototype.toString=function(){return'"'+this.value.join("")+'"'};StringClass.prototype.toPlain=function(){return this.value.join("")};StringClass.prototype.map=function(a){return new StringClass(this.value.map(a.willevaluate()))};StringClass.prototype.filter=function(a){return new StringClass(this.value.filter(a.willevaluate()))};StringClass.prototype.copy=function(){return new StringClass(this.value.slice())};function makestring(a){return new StringClass(slice(a).map(atoc))}function ConsClass(a,b){this.car=a||nil;this.cdr=b||nil}ConsClass.prototype=Object.create(SequencialClass.prototype);ConsClass.prototype.getcar=function(){return this.car};ConsClass.prototype.getcdr=function(){return this.cdr};ConsClass.prototype.setcar=function(a){this.car=a;return a};ConsClass.prototype.setcdr=function(a){this.cdr=a;return a};ConsClass.prototype.onexpand=function(){var a=this.expandarg();return a.expand.apply(a,arguments)};ConsClass.prototype.onevaluate=function(){var a=this.evaluatearg();return a.evaluate.apply(a,arguments)};ConsClass.prototype.onexpandarg=function(){var b=this.car;var a=this.cdr.toArray();return b.expand.apply(b,a)};ConsClass.prototype.onevaluatearg=function(){var b=this.car;var a=this.cdr.toArray();return b.evaluate.apply(b,a)};ConsClass.prototype.onexpanddata=function(){return new Expanded(this.toString())};ConsClass.prototype.toPlain=function(){return this.toArray().map(tostring).join(",")};ConsClass.prototype.toString=function(){return"["+this.toArray().map(tostring).join(",")+"]"};ConsClass.prototype.toLisp=function(){return"("+this.toArray().map(tolisp).join(" ")+")"};ConsClass.toCons=function(c){var a,b;for(a=nil,b=0;b<c.length;b++){a=makecons(c[b],a)}return a.reverse()};ConsClass.prototype.toCons=function(){return this};ConsClass.prototype.clone=function(){var b,a;for(b=nil,a=this;a!=nil;a=a.cdr){if(a.car instanceof UnQuoteAtClass){var d,c;for(d=a.car.evaluatearg(),c=d;c!=nil&&c.cdr!=nil;c=c.cdr){}c.cdr=b;b=d}else{if(a.car instanceof UnQuoteClass){b=new ConsClass(a.car.evaluatearg(),b)}else{b=new ConsClass(a.car,b)}}}return b.reverse()};ConsClass.prototype.toArray=function(){this.shouldlinear();var b,a;for(b=[],a=this;a!=nil;a=a.cdr){b.push(a.car)}return b};ConsClass.prototype.reverse=function(){var a,c,b;for(a=this,b=nil;a!=nil;){c=a.cdr;a.cdr=b;b=a;a=c}return b};ConsClass.prototype.islinear=function(){var a;for(a=this;a!=nil;a=a.cdr){if(a.cdr!=nil&&a.cdr instanceof ConsClass==false){return false}}return true};ConsClass.prototype.shouldlinear=function(){if(this.islinear()==false){throw ("list should be linear.")}};function makecons(a,b){return new ConsClass(a,b)}function makelist(){return ConsClass.toCons(arguments)}function NilClass(){}NilClass.prototype=Object.create(ConsClass.prototype);NilClass.prototype.car=nil;NilClass.prototype.cdr=nil;NilClass.prototype.getcar=function(){return nil};NilClass.prototype.getcdr=function(){return nil};NilClass.prototype.setcar=function(){throw new Error("nil cannot setcar.")};NilClass.prototype.setcdr=function(){throw new Error("nil cannot setcdr.")};NilClass.prototype.onevaluatearg=function(){return this};NilClass.prototype.onexpandarg=function(){return new Expanded(this.toString())};NilClass.prototype.onevaluate=NilClass.prototype.onevaluatearg;NilClass.prototype.onexpand=NilClass.prototype.onexpandarg;NilClass.prototype.status=function(){return false};NilClass.prototype.toLisp=function(){return"nil"};NilClass.prototype.toString=function(){return"null"};var nil=new NilClass();function QuoteFamilyClass(a){this.value=a}QuoteFamilyClass.prototype=Object.create(AtomClass.prototype);function UnQuoteClass(a){this.value=a}UnQuoteClass.prototype=Object.create(QuoteFamilyClass.prototype);UnQuoteClass.prototype.onevaluate=null;UnQuoteClass.prototype.onexpand=null;UnQuoteClass.prototype.toString=function(){return"/*--unquote--*/"+this.value.toString()};UnQuoteClass.prototype.onevaluatearg=function(){return this.value.evaluatearg()};UnQuoteClass.prototype.onexpandarg=function(){return this.value.expandarg()};function makeunquote(a){return new UnQuoteClass(a)}function UnQuoteAtClass(a){this.value=a}UnQuoteAtClass.prototype=Object.create(UnQuoteClass.prototype);UnQuoteAtClass.prototype.toString=function(){return"/*--unquoteat--*/"+this.value.toString()};function makeunquoteat(a){return new UnQuoteAtClass(a)}function CallableClass(){}CallableClass.prototype=Object.create(AtomClass.prototype);CallableClass.prototype.label="<#callable class>";CallableClass.prototype.toString=function(){return this.label};function FunctionClass(){}FunctionClass.prototype=Object.create(CallableClass.prototype);FunctionClass.prototype.label="<#function class>";function SpecialFunctionClass(){}SpecialFunctionClass.prototype=Object.create(FunctionClass.prototype);SpecialFunctionClass.label="<#special function class>";function PrimitiveFunctionClass(){}PrimitiveFunctionClass.prototype=Object.create(FunctionClass.prototype);PrimitiveFunctionClass.prototype.evaluate=beforeevaluatearg(beforegetreference(FunctionClass.prototype.evaluate));PrimitiveFunctionClass.prototype.expand=beforeexpandarg(beforegetreference(FunctionClass.prototype.expand));PrimitiveFunctionClass.prototype.label="<#primitive function class>";function UserFunctionClass(a,b){this.args=a||null;this.rest=b||null}UserFunctionClass.prototype=Object.create(FunctionClass.prototype);UserFunctionClass.prototype.label="<#user function class>";UserFunctionClass.prototype.onevaluate=function(){var e;var a,d,c;a=makecons(synprogn);d=this.args;c=ConsClass.toCons(arguments);for(;d!=nil&&c!=nil;d=d.cdr,c=c.cdr){if(d.car==makeintern("&rest")){break}if(d.car==makeintern("&optional")){break}a=makecons(makecons(macdeflvar,makecons(d.car,makecons(c.car))),a)}if(d.car==makeintern("&optional")){d=d.cdr;for(;d!=nil&&c!=nil;d=d.cdr,c=c.cdr){if(d.car==makeintern("&rest")){break}a=makecons(makecons(macdeflvar,(c==nil)?(d.car instanceof ConsClass==false)?(makecons(d.car,makecons(nil))):(makecons(d.car.car,makecons(d.car.cdr.car))):(d.car instanceof ConsClass==false)?(makecons(d.car,makecons(c.car))):(makecons(d.car.car,makecons(c.car)))),a)}}if(d.car==makeintern("&rest")){d=d.cdr;a=makecons(makelist(macdeflvar,d.car,makelist(synquote,c)),a)}a=a.reverse();e=makecons(synblock,makecons(a,this.rest));var b;b=("user function <- "+e+"");strace.push(b);stracedb.push(b);return e.evaluatearg()};function MacroClass(){}MacroClass.prototype=Object.create(CallableClass.prototype);MacroClass.prototype.evaluate=aftergetreference(afterevaluatearg(CallableClass.prototype.evaluate));MacroClass.prototype.expand=afterexpandarg(MacroClass.prototype.evaluate);function PrimitiveMacroClass(){}PrimitiveMacroClass.prototype=Object.create(MacroClass.prototype);function UserMacroClass(a,b){this.args=a||null;this.rest=b||null}UserMacroClass.prototype=Object.create(MacroClass.prototype);UserMacroClass.prototype.onevaluate=function(){var a=UserFunctionClass.prototype.onevaluate.apply(this,arguments);stracedb.push("user macro <- "+a+"");return a};function SymbolFamilyClass(){}SymbolFamilyClass.prototype=Object.create(AtomClass.prototype);SymbolFamilyClass.prototype.getvalue=function(){throw new Error("getvalue was not defined.")};SymbolFamilyClass.prototype.getfunc=function(){throw new Error("getfunc was not defined.")};SymbolFamilyClass.prototype.setvalue=function(){throw new Error("setvalue was not defined.")};SymbolFamilyClass.prototype.setfunc=function(){throw new Error("setfunc was not defined.")};function SymbolClass(a,c,b){this.name=a?a.copy():null;this.value=c||null;this.func=b||null}SymbolClass.prototype=Object.create(SymbolFamilyClass.prototype);SymbolClass.prototype.toString=function(){return this.name.toPlain()};SymbolClass.prototype.getvalue=function(){if(this.value==null){throw new Error("symbol "+this+" has no value.")}return this.value};SymbolClass.prototype.getfunc=function(){if(this.func==null){throw new Error("symbol "+this+" has no func.")}return this.func};SymbolClass.prototype.setvalue=function(a){this.value=a;return a};SymbolClass.prototype.setfunc=function(a){this.func=a;return a};SymbolClass.prototype.onevaluate=function(){var a=this.getfunc();return a.evaluate.apply(a,arguments)};SymbolClass.prototype.onevaluatearg=function(){return this.getvalue()};SymbolClass.prototype.onexpand=function(){var a=this.getfunc();return a.expand.apply(a,arguments)};SymbolClass.prototype.onexpandarg=function(){return new Expanded(this.toString())};var interneds=[];function InternSymbolClass(b){var a;for(a=0;a<interneds.length;a++){if(b.toString()==interneds[a].name.toString()){return interneds[a]}}this.name=b?b.copy():null;interneds.push(this)}InternSymbolClass.prototype=Object.create(SymbolFamilyClass.prototype);InternSymbolClass.prototype.toString=function(){return this.name.toPlain()};InternSymbolClass.prototype.getvalue=function(){return inp.scope.finde(this.name).getvalue()};InternSymbolClass.prototype.getfunc=function(){return inp.scope.finde(this.name).getfunc()};InternSymbolClass.prototype.setvalue=function(a){return inp.scope.finde(this.name).setvalue(a)};InternSymbolClass.prototype.setfunc=function(a){return inp.scope.finde(this.name).setfunc(a)};InternSymbolClass.prototype.onevaluate=function(){var a=inp.scope.finde(this.name);return a.evaluate.apply(a,arguments)};InternSymbolClass.prototype.onexpand=function(){var a=inp.scope.finde(this.name);return a.expand.apply(a,arguments)};InternSymbolClass.prototype.onevaluatearg=function(){var a=inp.scope.finde(this.name);return a.evaluatearg.apply(a,arguments)};InternSymbolClass.prototype.onexpandarg=function(){var a=inp.scope.finde(this.name);return a.expandarg.apply(a,arguments)};InternSymbolClass.prototype.getvaluename=function(){return inp.scope.finde(this.name).getvaluename()};InternSymbolClass.prototype.getfuncname=function(){return inp.scope.finde(this.name).getfuncname()};function makeintern(a){return new InternSymbolClass(makestring(a))}function VariableSymbolClass(a,c,b){this.name=a?a.copy():null;this.value=c||null;this.func=b||null;this.valuename=null;this.funcname=null}VariableSymbolClass.prototype=Object.create(SymbolClass.prototype);VariableSymbolClass.prototype.toString=function(){return this.getvaluename()};VariableSymbolClass.prototype.toString=function(){return this.getvaluename()+"/*--"+this.name+"--*/"};VariableSymbolClass.prototype.getvaluename=function(){if(this.valuename==null){this.valuename=inp.namegen.generate()}return this.valuename};VariableSymbolClass.prototype.getfuncname=function(){if(this.funcname==null){this.funcname=inp.namegen.generate()}return this.funcname};VariableSymbolClass.prototype.onexpandarg=function(){return new Expanded(this.getvaluename())};VariableSymbolClass.prototype.onexpand=function(){var a=this.getfunc();if(a==null||a instanceof UserFunctionClass){return new Expanded(this.getfuncname()+"("+slice(arguments).map(expandarg).join(",")+")")}return a.expand.apply(a,arguments)};function getvaluename(a){if(a instanceof SymbolFamilyClass==false){throw new Error("some is not symbol family class.")}return a.getvaluename()}function getfuncname(a){if(a instanceof SymbolFamilyClass==false){throw new Error("some is not symbol family class.")}return a.getfuncname()}function makevar(a,c,b){return new VariableSymbolClass(makestring(a),c,b)}function StreamClass(a){this.direction=a}StreamClass.prototype=Object.create(AtomClass.prototype);StreamClass.direction={};StreamClass.direction.input=(1|0);StreamClass.direction.output=(2|0);StreamClass.onevaluate=null;StreamClass.onexpand=null;StreamClass.onexpandarg=null;StreamClass.onexpanddata=null;StreamClass.prototype.iseof=function(){throw new Error("iseof was not defined.")};StreamClass.prototype.isalive=function(){throw new Error("isalive was not defined.")};StreamClass.prototype.look=function(){throw new Error("look was not defined.")};StreamClass.prototype.get=function(){throw new Error("get was not defined.")};StreamClass.prototype.put=function(){throw new Error("put was not defined.")};StreamClass.prototype.isin=function(){return new Boolean(this.direction&StreamClass.direction.input)};StreamClass.prototype.isout=function(){return new Boolean(this.direction&StreamClass.direction.output)};StreamClass.prototype.shouldin=function(){if(this.isin()==false){throw new Error("stream should input direction!")}};StreamClass.prototype.shouldout=function(){if(this.isout()==false){throw new Error("stream should output direction!")}};function StringStreamClass(b,a){this.direction=b;this.source=a;this.sourceout=new StringClass();this.index=0}StringStreamClass.prototype=Object.create(StreamClass.prototype);StringStreamClass.prototype.iseof=function(){this.shouldin();return this.source.length()<=this.index};StringStreamClass.prototype.isalive=function(){this.shouldin();return this.iseof()==false};StringStreamClass.prototype.look=function(){this.shouldin();return this.iseof()?nilf:this.source.nth(this.index)};StringStreamClass.prototype.get=function(){this.shouldin();return this.iseof()?nilf:this.source.nth(this.index++)};StringStreamClass.prototype.put=function(a){this.shouldout();return this.source.push(a)};function Obarray(){this.obarray={}}Obarray.prototype.find=function(a){return this.obarray[a.toPlain()]||null};Obarray.prototype.set=function(b,a){return this.obarray[b.toPlain()]=a};Obarray.prototype.intern=function(a){if(this.find(a)==null){this.set(a,new VariableSymbolClass(a))}return new InternSymbolClass(a)};function Obarrays(a){this.obarray=new Obarray();this.parent=a||null}Obarrays.prototype.find=function(a){var c,b;for(c=this;c;c=c.parent){if((b=c.obarray.find(a))){return b}}return null};Obarrays.prototype.finde=function(a){var b;if((b=this.find(a))==null){throw new Error("obarrays "+a+" was not found.")}return b};Obarrays.prototype.intern=function(a){if(this.find(a)==null){return this.obarray.intern(a)}return new InternSymbolClass(a)};Obarrays.prototype.internf=function(a){return this.obarray.intern(a)};Obarrays.prototype.nest=function(){return new Obarrays(this)};Obarrays.prototype.exit=function(){return this.parent};function Obscope(a){this.obarray=new Obarrays(null);this.obarrays=new Array();this.parent=a||null}Obscope.prototype.find=function(a){var b,c;for(c=this;c;c=c.parent){if((b=c.obarray.find(a))){return b}}return null};Obscope.prototype.finde=function(a){var b=this.find(a);if(b){return b}throw new Error("obscope "+a+" was not found.")};Obscope.prototype.intern=function(a){if(this.find(a)==null){return this.obarray.intern(a)}return new InternSymbolClass(a)};Obscope.prototype.internf=function(a){this.obarray.internf(a);return this.obarray.internf(a)};Obscope.prototype.nestin=function(){this.obarray=this.obarray.nest()};Obscope.prototype.exitin=function(){this.obarrays.push(this.obarray);this.obarray=this.obarray.exit()};Obscope.prototype.nest=function(){return new Obscope(this)};Obscope.prototype.exit=function(){return this.parent};function ReaderScope(a){this.scope={};this.method=a||null}ReaderScope.prototype.get=function(a){return this.scope[a.toString()]||null};ReaderScope.prototype.getcurrent=function(){return this.method||null};ReaderScope.prototype.dig=function(a){if(this.scope[a.toString()]==null){this.scope[a.toString()]=new ReaderScope()}return this.scope[a.toString()]};ReaderScope.prototype.set=function(a,b){return this.dig(a).setcurrent(b)};ReaderScope.prototype.setcurrent=function(a){return this.method=a};function Interpreter(){this.scope=new Obscope();this.scoperoot=this.scope;this.readerscope=new ReaderScope();this.namegen=new NameGenerator("abcdefghijklmnopqrstuvwxyz")}Interpreter.prototype.nestin=function(){inp.scope.nestin();return null};Interpreter.prototype.exitin=function(){inp.scope.exitin();return null};Interpreter.prototype.nest=function(){this.scope=this.scope.nest();return null};Interpreter.prototype.exit=function(){this.scope=this.scope.exit();return null};var inp=new Interpreter();inp.scope.intern(makestring("nil")).setvalue(nil);inp.scope.intern(makestring("t")).setvalue(t);var rdignoreindent=new PrimitiveFunctionClass();var rdread=new PrimitiveFunctionClass();var rdreadintern=new PrimitiveFunctionClass();var rdreadminus=new PrimitiveFunctionClass();var rdreadnumber=new PrimitiveFunctionClass();var rdreadstring=new PrimitiveFunctionClass();var rdreadopenbrace=new PrimitiveFunctionClass();var rdreadclosebrace=new PrimitiveFunctionClass();var rdreadclosebrace_unique=new Unique();var rdreadquote=new PrimitiveFunctionClass();var rdreadquoteback=new PrimitiveFunctionClass();var rdreadunquote=new PrimitiveFunctionClass();var rdreadunquoteat=new PrimitiveFunctionClass();var rdreadchar=new PrimitiveFunctionClass();var rdreadpre=new PrimitiveFunctionClass();var rdreadnative=new PrimitiveFunctionClass();rdignoreindent.onevaluate=function(a){while(a.isalive()&&a.look().get().value==" ".charCodeAt()||a.look().get().value=="\t".charCodeAt()){a.get()}return nil};rdread.onevaluate=function(e){rdignoreindent.evaluate(e);var d,c;var b,a;for(d=inp.readerscope,b=nil;e.isalive();){a=e.look();c=d.get(a);if(c==null){break}b=e.get();d=c}if(d.getcurrent()==null){throw new Error("method was not found.")}return d.getcurrent().evaluate(e,b)};rdreadintern.onevaluate=function(b){rdignoreindent.evaluate(b);var a;for(a=new StringClass();b.isalive();){if(inp.readerscope.get(b.look())||b.look().get().value==(" ".charCodeAt())||b.look().get().value==("\t".charCodeAt())){break}else{a.push(b.get())}}if(a.length()==0){return nil}inp.scoperoot.intern(a);return new InternSymbolClass(a)};rdreadminus.onevaluate=function(b){var a=rdread.evaluate(b);a.value*=-1;return a};rdreadnumber.onevaluate=function(c,d){var b,a;for(a=d.toString();c.isalive();){if("123456890.".indexOf(c.look().toString())>=0){a+=c.get().toString()}else{break}}return a.indexOf(".")>=0?new FloatClass(parseFloat(a)).constant():new IntClass(parseInt(a)).constant()};rdreadstring.onevaluate=function(d,a){var c,b;for(b=new StringClass();d.isalive()&&(c=d.get()).status();){if(c.get().value==a.value){break}else{b.push(c)}}return b.constant()};rdreadopenbrace.onevaluate=function(c){var a,b;for(a=nil;c.isalive()&&(b=rdread.evaluate(c))!=rdreadclosebrace_unique;){a=new ConsClass(b,a)}return a.reverse().constant()};rdreadclosebrace.onevaluate=function(a){return rdreadclosebrace_unique};rdreadquote.onevaluate=function(a){return makelist(synquote,rdread.evaluate(a))};rdreadquoteback.onevaluate=function(a){return makelist(synquoteback,rdread.evaluate(a))};rdreadunquote.onevaluate=function(a){return new UnQuoteClass(rdread.evaluate(a))};rdreadunquoteat.onevaluate=function(a){return new UnQuoteAtClass(rdread.evaluate(a))};rdreadchar.onevaluate=function(a){return new CharClass(a.get())};rdreadpre.onevaluate=function(a){var b=rdread.evaluate(a);return b.evaluatearg()};rdreadnative.onevaluate=function(b){var a=rdread.evaluate(b);return new Expanded(a.name.toPlain())};inp.readerscope.setcurrent(rdreadintern);inp.readerscope.dig("'").setcurrent(rdreadquote);inp.readerscope.dig("`").setcurrent(rdreadquoteback);inp.readerscope.dig(",").setcurrent(rdreadunquote);inp.readerscope.dig(",").dig("@").setcurrent(rdreadunquoteat);inp.readerscope.dig("-").setcurrent(rdreadminus);inp.readerscope.dig('"').setcurrent(rdreadstring);inp.readerscope.dig("(").setcurrent(rdreadopenbrace);inp.readerscope.dig(")").setcurrent(rdreadclosebrace);inp.readerscope.dig("0").setcurrent(rdreadnumber);inp.readerscope.dig("1").setcurrent(rdreadnumber);inp.readerscope.dig("2").setcurrent(rdreadnumber);inp.readerscope.dig("3").setcurrent(rdreadnumber);inp.readerscope.dig("4").setcurrent(rdreadnumber);inp.readerscope.dig("5").setcurrent(rdreadnumber);inp.readerscope.dig("6").setcurrent(rdreadnumber);inp.readerscope.dig("7").setcurrent(rdreadnumber);inp.readerscope.dig("8").setcurrent(rdreadnumber);inp.readerscope.dig("9").setcurrent(rdreadnumber);inp.readerscope.dig("?").setcurrent(rdreadchar);inp.readerscope.dig("@").dig(".").setcurrent(rdreadpre);inp.readerscope.dig("@").dig("@").setcurrent(rdreadnative);var synif=new SpecialFunctionClass();var synblock=new SpecialFunctionClass();var synprogn=new SpecialFunctionClass();var synsetf=new SpecialFunctionClass();var synquote=new SpecialFunctionClass();var synquoteback=new SpecialFunctionClass();var synlambda=new SpecialFunctionClass();var synmacro=new SpecialFunctionClass();inp.scope.intern(makestring("if")).setfunc(synif);inp.scope.intern(makestring("block")).setfunc(synblock);inp.scope.intern(makestring("progn")).setfunc(synprogn);inp.scope.intern(makestring("setf")).setfunc(synsetf);inp.scope.intern(makestring("quote")).setfunc(synquote);inp.scope.intern(makestring("quoteb")).setfunc(synquoteback);synif.label="<#syntax if>";synblock.label="<#syntax block>";synprogn.label="<#syntax progn>";synsetf.label="<#syntax setf>";synquote.label="<#syntax quote>";synquoteback.label="<#syntax quoteback>";synlambda.label="<#syntax lambda>";synmacro.label="<#syntax macro>";synif.onevaluate=function(c,a,b){if(getreference(c.evaluatearg())!=nil){return getreference(a.evaluatearg())}return getreference(b.evaluatearg())};synif.onexpand=function(c,a,b){return new Expanded("("+c.expandarg()+"==null?"+b.expandarg()+":"+a.expandarg()+")")};synblock.onevaluate=function(){inp.nestin();var a=synprogn.evaluate.apply(synprogn,arguments);inp.exitin();return a};synprogn.onevaluate=function(){var b,a;for(b=nil,a=0;a<arguments.length;a++){b=arguments[a].evaluatearg()}return b};synsetf.onevaluate=function(d,c){strace.push("setf  <- "+d+" = "+c+"");var a=getreference(c.evaluatearg());var b=d.evaluatearg();return b.set(a)};synquote.onevaluate=function(a){return a};synquoteback.onevaluate=function(a){return a.clone()};synlambda.onevaluate=function(a){return new UserFunctionClass(a,ConsClass.toCons(slice(arguments,1)))};synmacro.onevaluate=function(a){return new UserMacroClass(a,ConsClass.toCons(slice(arguments,1)))};var macprog1=new PrimitiveMacroClass();var macdefun=new PrimitiveMacroClass();var macdefmacro=new PrimitiveMacroClass();var macsetq=new PrimitiveMacroClass();var macincf=new PrimitiveMacroClass();var macdecf=new PrimitiveMacroClass();var maclet=new PrimitiveMacroClass();var macflet=new PrimitiveMacroClass();var macmlet=new PrimitiveMacroClass();var macdefvar=new PrimitiveMacroClass();var macdeflvar=new PrimitiveMacroClass();inp.scope.intern(makestring("prog1")).setfunc(macprog1);inp.scope.intern(makestring("defun")).setfunc(macdefun);inp.scope.intern(makestring("defmacro")).setfunc(macdefmacro);inp.scope.intern(makestring("setq")).setfunc(macsetq);inp.scope.intern(makestring("incf")).setfunc(macincf);inp.scope.intern(makestring("decf")).setfunc(macdecf);inp.scope.intern(makestring("let")).setfunc(maclet);inp.scope.intern(makestring("flet")).setfunc(macflet);inp.scope.intern(makestring("mlet")).setfunc(macmlet);inp.scope.intern(makestring("defvar")).setfunc(macdefvar);inp.scope.intern(makestring("deflvar")).setfunc(macdeflvar);macprog1.label="<#primtive macro prog1>";macdefun.label="<#primtive macro defun>";macdefmacro.label="<#primtive macro defmacro>";macsetq.label="<#primtive macro setq>";macincf.label="<#primtive macro incf>";macdecf.label="<#primtive macro decf>";maclet.label="<#primtive macro let>";macflet.label="<#primtive macro flet>";macmlet.label="<#primtive macro mlet>";macdefvar.label="<#primtive macro defvar>";macdeflvar.label="<#primtive macro deflvar>";macprog1.onevaluate=function(b){var a=makevar("");return makecons(maclet,makecons(makecons(makecons(a,makecons(b))),makecons(makecons(synprogn,makecons(makecons(synprogn,ConsClass.toCons(slice(arguments,1))),makecons(a))))))};macincf.onevaluate=function(a){return makelist(synsetf,a,makelist(basadd,a,makeint(1)))};macdecf.onevaluate=function(a){return makelist(synsetf,a,makelist(bassub,a,makeint(1)))};macdefvar.onevaluate=function(a,b){return makelist(synsetf,makelist(bassymbolvalue,makelist(basglobal,makelist(synquote,a))),b)};macdeflvar.onevaluate=function(a,b){return makelist(synsetf,makelist(bassymbolvalue,makelist(baslocal,makelist(synquote,a))),b)};macdefun.onevaluate=function(a){return new ConsClass(synsetf,new ConsClass(new QuoteClass(new SymbolFunctionReferenceClass(a)),new ConsClass(new ConsClass(synlambda,ConsClass.toCons(slice(arguments,1))))))};macdefmacro.onevaluate=function(a){return new ConsClass(synsetf,new ConsClass(new QuoteClass(new SymbolFunctionReferenceClass(a)),new ConsClass(new ConsClass(synmacro,ConsClass.toCons(slice(arguments,1))))))};macsetq.onevaluate=function(a,b){return new ConsClass(synsetf,new ConsClass(new QuoteClass(new SymbolValueReferenceClass(a)),new ConsClass(b)))};maclet.onevaluate=function(b){var a,c;for(a=makecons(synprogn);b!=nil;b=b.cdr){a=makecons(makecons(macdeflvar,b.car),a)}return makecons(synblock,makecons(a.reverse(),ConsClass.toCons(slice(arguments,1))))};macflet.onevaluate=function(b){var a,c;for(a=makecons(synprogn);b!=nil;b=b.cdr){a=makecons(makelist(synsetf,makelist(bassymbolfunction,makelist(synquote,b.car.car)),makecons(synlambda,b.car.cdr)),a)}return makecons(synblock,makecons(a.reverse(),ConsClass.toCons(slice(arguments,1))))};macmlet.onevaluate=function(b){var a,c;for(a=makecons(synprogn);b!=nil;b=b.cdr){a=makecons(makelist(synsetf,makelist(bassymbolfunction,makelist(synquote,b.car.car)),makecons(synmacro,b.car.cdr)),a)}return makecons(synblock,makecons(a.reverse(),ConsClass.toCons(slice(arguments,1))))};var baslocal=new PrimitiveFunctionClass();var basglobal=new PrimitiveFunctionClass();baslocal.label="<#primitive local>";basglobal.label="<#primitive global>";baslocal.onevaluate=function(a){return inp.scope.internf(a.name)};basglobal.onevaluate=function(a){return inp.scoperoot.internf(a.name)};var bassymbolfunction=new PrimitiveFunctionClass();var bassymbolvalue=new PrimitiveFunctionClass();var bassymbolname=new PrimitiveFunctionClass();var bassymbolintern=new PrimitiveFunctionClass();var bassymbolmake=new PrimitiveFunctionClass();bassymbolfunction.label="<#primitive symbol-function>";bassymbolvalue.label="<#primitive symbol-value>";bassymbolname.label="<#primitive symbol-name>";bassymbolintern.label="<#primitive symbol-intern>";bassymbolmake.label="<#primtive symbol-make>";bassymbolfunction.onevaluate=function(a){return new SymbolFunctionReferenceClass(a)};bassymbolvalue.onevaluate=function(a){return new SymbolValueReferenceClass(a)};bassymbolname.onevaluate=function(a){return a.name};bassymbolintern.onevaluate=function(a){return new InternSymbolClass(a)};bassymbolmake.onevaluate=function(a){return new VariableSymbolClass(a)};var basadd=new PrimitiveFunctionClass();var bassub=new PrimitiveFunctionClass();var basnumadd2=new PrimitiveFunctionClass();var basnumsub2=new PrimitiveFunctionClass();var basnummul2=new PrimitiveFunctionClass();var basnumdiv2=new PrimitiveFunctionClass();var basnummod2=new PrimitiveFunctionClass();var basnumand2=new PrimitiveFunctionClass();var basnumor2=new PrimitiveFunctionClass();var basnumnot2=new PrimitiveFunctionClass();var basnumeq2=new PrimitiveFunctionClass();var basnumless2=new PrimitiveFunctionClass();var basnumlesseq2=new PrimitiveFunctionClass();var basnumlarge2=new PrimitiveFunctionClass();var basnumlargeq2=new PrimitiveFunctionClass();var basintadd2=new PrimitiveFunctionClass();var basintsub2=new PrimitiveFunctionClass();var basintmul2=new PrimitiveFunctionClass();var basintdiv2=new PrimitiveFunctionClass();var basintmod2=new PrimitiveFunctionClass();var basintand2=new PrimitiveFunctionClass();var basintor2=new PrimitiveFunctionClass();var basintnot2=new PrimitiveFunctionClass();var basfloatadd2=new PrimitiveFunctionClass();var basfloatsub2=new PrimitiveFunctionClass();var basfloatmul2=new PrimitiveFunctionClass();var basfloatdiv2=new PrimitiveFunctionClass();basnumeq2.onevaluate=function(d,c){return(d.value==c.value)?t:nil};basnumless2.onevaluate=function(d,c){return(d.value<c.value)?t:nil};basnumlesseq2.onevaluate=function(d,c){return(d.value<=c.value)?t:nil};basnumlarge2.onevaluate=function(d,c){return(d.value>c.value)?t:nil};basnumlargeq2.onevaluate=function(d,c){return(d.value>=c.value)?t:nil};basfloatadd2.onevaluate=function(d,c){return new FloatClass(d.value+c.value)};basfloatsub2.onevaluate=function(d,c){return new FloatClass(d.value-c.value)};basfloatmul2.onevaluate=function(d,c){return new FloatClass(d.value*c.value)};basfloatdiv2.onevaluate=function(d,c){return new FloatClass(d.value/c.value)};basintadd2.onevaluate=function(d,c){if(c instanceof IntClass){return new IntClass(d.value+c.value)}return basnumadd2.evaluate(c,d)};basintsub2.onevaluate=function(d,c){if(c instanceof IntClass){return new IntClass(d.value-c.value)}return basnumsub2.evaluate(c,d)};basintmul2.onevaluate=function(d,c){if(c instanceof IntClass){return new IntClass(d.value*c.value)}return basnummul2.evaluate(c,d)};basintdiv2.onevaluate=function(d,c){if(c instanceof IntClass){return new IntClass(d.value/c.value)}return basnumdiv2.evaluate(c,d)};basintmod2.onevaluate=function(d,c){if(c instanceof IntClass){return new IntClass(d.value%c.value)}return basnummod2.evaluate(c,d)};basintand2.onevaluate=function(d,c){if(c instanceof IntClass){return new IntClass(d.value&c.value)}return basnumand2.evaluate(c,d)};basintor2.onevaluate=function(d,c){if(c instanceof IntClass){return new IntClass(d.value|c.value)}return basnumor2.evaluate(c,d)};basintnot2.onevaluate=function(b){return new IntClass(~b.value)};var basfnfuncall=new PrimitiveFunctionClass();var basfnapply=new PrimitiveFunctionClass();basfnfuncall.label="<#primitive funcall>";basfnapply.label="<#primitive apply>";basfnfuncall.onevaluate=function(a){return a.evaluate.apply(a,slice(arguments,1))};basfnapply.onevaluate=function(b,a){return b.evaluate.apply(b,a.toArray())};var basdebprint=new PrimitiveFunctionClass();var basdebstrace=new PrimitiveFunctionClass();var basdebstracedb=new PrimitiveFunctionClass();basdebprint.label="<#debug print>";basdebstrace.label="<#debug strace>";basdebprint.onevaluate=function(a){console.log(a+"");return a};basdebstrace.onevaluate=function(){strace.print();return nil};basdebstracedb.onevaluate=function(){stracedb.print();return nil};var basconcons=new PrimitiveFunctionClass();var basconcar=new PrimitiveFunctionClass();var basconcdr=new PrimitiveFunctionClass();var basconlist=new PrimitiveFunctionClass();var basconcaar=new UserFunctionClass();var basconcaar_cons=makeintern("cons");var basconcdar=new UserFunctionClass();var basconcdar_cons=makeintern("cons");var basconcadr=new UserFunctionClass();var basconcadr_cons=makeintern("cons");var basconcddr=new UserFunctionClass();var basconcddr_cons=makeintern("cons");basconcons.label="<#primitive cons cons>";basconcar.label="<#primitive cons car>";basconcdr.label="<#primitive cons cdr>";basconcaar.label="<#primitive cons caar>";basconcadr.label="<#primitive cons cadr>";basconcdar.label="<#primitive cons cdar>";basconcddr.label="<#primitive cons cddr>";basconlist.label="<#primitive cons list>";inp.scope.intern(makestring("cons")).setfunc(basconcons);inp.scope.intern(makestring("car")).setfunc(basconcar);inp.scope.intern(makestring("cdr")).setfunc(basconcdr);inp.scope.intern(makestring("caar")).setfunc(basconcaar);inp.scope.intern(makestring("cadr")).setfunc(basconcadr);inp.scope.intern(makestring("cdar")).setfunc(basconcdar);inp.scope.intern(makestring("cddr")).setfunc(basconcddr);inp.scope.intern(makestring("list")).setfunc(basconlist);basconcons.onevaluate=function(a,b){return new ConsReferenceClass(new ConsClass(a,b))};basconcar.onevaluate=function(a){return new ConsCarReferenceClass(a)};basconcdr.onevaluate=function(a){return new ConsCdrReferenceClass(a)};basconlist.onevaluate=function(){return new ConsReferenceClass(ConsClass.toCons(arguments))};basconcaar.args=makelist(basconcaar_cons);basconcaar.rest=makelist(makelist(basconcar,makelist(basconcar,basconcaar_cons)));basconcadr.args=makelist(basconcadr_cons);basconcadr.rest=makelist(makelist(basconcdr,makelist(basconcar,basconcadr_cons)));basconcdar.args=makelist(basconcdar_cons);basconcdar.rest=makelist(makelist(basconcar,makelist(basconcdr,basconcdar_cons)));basconcddr.args=makelist(basconcddr_cons);basconcddr.rest=makelist(makelist(basconcdr,makelist(basconcdr,basconcddr_cons)));var basnull=new UserFunctionClass();var basnull_some=makeintern("some");var basnot=new UserFunctionClass();var basnot_some=makeintern("some");var macand=new UserMacroClass();var macand_rest=makeintern("&rest");var macand_args=makeintern("args");var macor=new UserMacroClass();var macor_rest=makeintern("&rest");var macor_args=makeintern("args");var macwhen=new UserMacroClass();var macwhen_cond=makeintern("cond");var macwhen_rest=makeintern("&rest");var macwhen_args=makeintern("args");var macunless=new UserMacroClass();var macunless_cond=makeintern("cond");var macunless_rest=makeintern("&rest");var macunless_args=makeintern("args");var maccond=new UserMacroClass();var maccond_rest=makeintern("&rest");var maccond_args=makeintern("args");var maccase=new UserMacroClass();var maccase_rest=makeintern("&rest");var maccase_args=makeintern("args");basnull.label="<#primitive basic null>";basnot.label="<#primitive basic not>";macand.label="<#primitive macro and>";macor.label="<#primitive macro or>";macwhen.label="<#primitive macro when>";macunless.label="<#primitive macro unless>";maccond.label="<#primitive macro cond>";maccase.label="<#primitive macro case>";inp.scope.intern(makestring("null")).setfunc(basnull);inp.scope.intern(makestring("not")).setfunc(basnot);inp.scope.intern(makestring("and")).setfunc(macand);inp.scope.intern(makestring("or")).setfunc(macor);inp.scope.intern(makestring("when")).setfunc(macwhen);inp.scope.intern(makestring("unless")).setfunc(macunless);inp.scope.intern(makestring("cond")).setfunc(maccond);inp.scope.intern(makestring("case")).setfunc(maccase);basnull.args=makelist(basnull_some);basnull.rest=makelist(makelist(synif,basnull_some,nil,t));basnot.args=makelist(basnot_some);basnot.args=makelist(makelist(synif,basnot_some,nil,t));macand.args=makelist(macand_rest,macand_args);macand.rest=makelist(synif,makelist(basnull,macand_args),t,makelist(synif,makelist(basnull,makelist(basconcdr,macand_args)),makelist(basconcar,macand_args),makelist(basconlist,synif,makelist(basconcar,macand_args),makelist(basconcons,macand,makelist(basconcdr,macand_args)),makelist())));macor.args=makelist(macor_rest,macor_args);macor.rest=makelist(makelist(synif,makelist(basnull,macor_args),nil,makelist(synif,makelist(basnull,makelist(basconcdr,macor_args)),makelist(basconcar,macor_args),makelist(basconlist,synif,makelist(basconcar,macor_args),makelist(basconcar,macor_args),makelist(basconcons,macor,makelist(basconcdr,macor_args))))));macwhen.args=makelist(macwhen_cond,macwhen_rest,macwhen_args);macwhen.rest=makelist(makelist(basconlist,synif,macwhen_cond,makelist(basconcons,synprogn,macwhen_args),nil));macunless.args=makelist(macunless_cond,macunless_rest,macunless_args);macunless.rest=makelist(makelist(basconlist,synif,macunless_cond,nil,makelist(basconcons,synprogn,macunless_args)));maccond.args=makelist(maccond_rest,maccond_args);maccond.rest=makelist(makelist(synif,makelist(basnull,maccond_args),nil,makelist(basconlist,synif,makelist(basconcaar,maccond_args),makelist(basconcdar,maccond_args),makelist(basconcons,maccond,makelist(basconcdr,maccond_args)))));var basconmap=new UserFunctionClass();var basconmap_func=makeintern("func");var basconmap_sequence=makeintern("sequence");var basconfilter=new UserFunctionClass();var basconfilter_func=makeintern("func");var basconfilter_sequence=makeintern("sequence");var basconreduce=new UserFunctionClass();var basconreduce_func=makeintern("func");var basconreduce_sequence=makeintern("sequence");var basconreducein=new UserFunctionClass();var basconreducein_func=makeintern("func");var basconreducein_sum=makeintern("sum");var basconreducein_sequence=makeintern("sequence");var basconlength=new UserFunctionClass();var basconlength_sequence=makeintern("sequence");var basconnth=new UserFunctionClass();var basconnth_index=makeintern("index");var basconnth_sequence=makeintern("sequence");var basconappend2=new UserFunctionClass();var basconappend2_sequence=makeintern("sequence");var basconappend2_sequencec=makeintern("sequencec");var basconappend=new UserFunctionClass();var basconappend_rest=makeintern("&rest");var basconappend_args=makeintern("args");var basconfindif=new UserFunctionClass();var basconfindif_func=makeintern("func");var basconfindif_sequence=makeintern("sequence");var basconpositionif=new UserFunctionClass();var basconpositionif_func=makeintern("func");var basconpositionif_sequence=makeintern("sequence");var basconpositionifin=new UserFunctionClass();var basconpositionifin_func=makeintern("func");var basconpositionifin_sequence=makeintern("sequence");var basconpositionifin_count=makeintern("count");var basconcopy=new UserFunctionClass();var basconcopy_sequence=makeintern("sequence");var basconnreverse=new UserFunctionClass();var basconnreverse_sequence=makeintern("sequence");var basconnreversein=new UserFunctionClass();var basconnreversein_sequence=makeintern("sequence");var basconnreversein_before=makeintern("before");var basconnreversein_after=makeintern("after");basconmap.label="<#primitive cons map>";basconfilter.label="<#primitive cons filter>";basconreduce.label="<#primitive cons reduce>";basconreducein.label="<#primitive cons reducein>";basconlength.label="<#primitive cons length>";basconnth.label="<#primitive cons nth>";basconappend2.label="<#primitive cons append2>";basconappend.label="<#primitive cons append>";basconfindif.label="<#primitive cons findif>";basconpositionif.label="<#primitive cons positionif>";basconcopy.label="<#primitive cons copy>";basconnreverse.label="<#primitive cons nreverse>";basconnreversein.label="<#primitive cons nreversein>";basconmap.args=makelist(basconmap_func,basconmap_sequence);basconmap.rest=makelist(makelist(synif,makelist(basnull,basconmap_sequence),nil,makelist(basconcons,makelist(basfnfuncall,basconmap_func,makelist(basconcar,basconmap_sequence)),makelist(basconmap,basconmap_func,makelist(basconcdr,basconmap_sequence)))));basconfilter.args=makelist(basconfilter_func,basconfilter_sequence);basconfilter.rest=makelist(makelist(synif,makelist(basnull,basconfilter_sequence),nil,makelist(synif,makelist(basfnfuncall,basconfilter_func,makelist(basconcar,basconfilter_sequence)),makelist(basconcons,makelist(basconcar,basconfilter_sequence),makelist(basconfilter,basconfilter_func,makelist(basconcdr,basconfilter_sequence))),makelist(basconfilter,basconfilter_func,makelist(basconcdr,basconfilter_sequence)))));basconreduce.args=makelist(basconreduce_func,basconreduce_sequence);basconreduce.rest=makelist(makelist(synif,makelist(basnull,basconreduce_sequence),nil,makelist(synif,makelist(basnull,makelist(basconcdr,basconreduce_sequence)),makelist(basconcar,basconreduce_sequence),makelist(basconreducein,basconreduce_func,makelist(basconcar,basconreduce_sequence),makelist(basconcdr,basconreduce_sequence)))));basconreducein.args=makelist(basconreducein_func,basconreducein_sum,basconreducein_sequence);basconreducein.rest=makelist(makelist(synif,makelist(basnull,basconreducein_sequence),basconreducein_sum,makelist(basconreducein,basconreducein_func,makelist(basfnfuncall,basconreducein_func,basconreducein_sum,makelist(basconcar,basconreducein_sequence)),makelist(basconcdr,basconreducein_sequence))));basconlength.args=makelist(basconlength_sequence);basconlength.rest=makelist(makelist(synif,makelist(basnull,basconlength_sequence),makeint(0),makelist(basadd,makeint(1),makelist(basconlength,makelist(basconcdr,basconlength_sequence)))));basconnth.args=makelist(basconnth_index,basconnth_sequence);basconnth.rest=makelist(makelist(synif,makelist(basnull,basconnth_sequence),nil,makelist(synif,makelist(basnumeq2,basconnth_index,makeint(0)),makelist(basconcar,basconnth_sequence),makelist(basconnth,makelist(bassub,basconnth_index,makeint(1)),makelist(basconcdr,basconnth_sequence)))));basconappend2.args=makelist(basconappend2_sequence,basconappend2_sequencec);basconappend2.rest=makelist(makelist(synif,makelist(basnull,basconappend2_sequence),basconappend2_sequencec,makelist(basconcons,makelist(basconcar,basconappend2_sequence),makelist(basconappend2,makelist(basconcdr,basconappend2_sequence),basconappend2_sequencec))));basconappend.args=makelist(basconappend_rest,basconappend_args);basconappend.rest=makelist(makelist(basconreduce,basconappend2,basconappend_args));basconfindif.args=makelist(basconfindif_func,basconfindif_sequence);basconfindif.rest=makelist(makelist(synif,makelist(basnull,basconfindif_sequence),nil,makelist(synif,makelist(basfnfuncall,basconfindif_func,makelist(basconcar,basconfindif_sequence)),makelist(basconcar,basconfindif_sequence),makelist(basconfindif,basconfindif_func,makelist(basconcdr,basconfindif_sequence)))));basconpositionif.args=makelist(basconpositionif_func,basconpositionif_sequence);basconpositionif.rest=makelist(makelist(basconpositionifin,basconpositionif_func,basconpositionif_sequence,makeint(0)));basconpositionifin.args=makelist(basconpositionifin_func,basconpositionifin_sequence,basconpositionifin_count);basconpositionifin.rest=makelist(makelist(synif,makelist(basnull,basconpositionifin_sequence),nil,makelist(synif,makelist(basfnfuncall,basconpositionifin_func,makelist(basconcar,basconpositionifin_sequence)),basconpositionifin_count,makelist(basconpositionifin,basconpositionifin_func,makelist(basconcdr,basconpositionifin_sequence),makelist(basadd,basconpositionifin_count,makeint(1))))));basconcopy.args=makelist(basconcopy_sequence);basconcopy.rest=makelist(makelist(synif,makelist(basnull,basconcopy_sequence),nil,makelist(basconcons,makelist(basconcar,basconcopy_sequence),makelist(basconcopy,makelist(basconcdr,basconcopy_sequence)))));basconnreverse.args=makelist(basconnreverse_sequence);basconnreverse.rest=makelist(makelist(basconnreversein,nil,basconnreverse_sequence,makelist(basconcdr,basconnreverse_sequence)));basconnreversein.args=makelist(basconnreversein_before,basconnreversein_sequence,basconnreversein_after);basconnreversein.rest=makelist(makelist(synif,makelist(basnull,basconnreversein_sequence),nil,makelist(synprogn,makelist(synsetf,makelist(basconcdr,basconnreversein_sequence),basconnreversein_before),makelist(synif,makelist(basnull,basconnreversein_after),basconnreversein_sequence,makelist(basconnreversein,basconnreversein_sequence,basconnreversein_after,makelist(basconcdr,basconnreversein_after))))));var source;source=makelist(maccond,makelist(nil,makeint(1)),makelist(nil,makeint(2)),makelist(t,makeint(3)));strace.unwindstrace(function(){console.log(""+source+"");console.log(""+source.evaluatearg()+"");stracedb.print()})();