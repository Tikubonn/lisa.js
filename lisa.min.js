function slice(c,b,a){return Array.prototype.slice.call(c,b,a)}function Unique(){}function NameGenerator(a){this.source=a;this.index=0}NameGenerator.prototype.generate=function(){var b="";var a=this.index++;var c=this.source;do{b+=c[a%c.length];a=a/c.length|0}while(a);return b};function NameGeneratorIgnore(a,b){this.source=a;this.index=0;this.ignores=b}NameGeneratorIgnore.prototype.generate=function(){var a;while(this.ignores.indexOf((a=NameGenerator.prototype.generate.call(this)))>=0){}return a};function Constantable(){}Constantable.prototype.constantable=false;Constantable.prototype.constant=function(){this.constantable=true;return this};Constantable.prototype.notconstant=function(){this.constantable=false;return this};Constantable.prototype.inherit=function(a){this.constantable=a.isconstant();return this};Constantable.prototype.isconstant=function(){return this.constantable};Constantable.prototype.isnotconstant=function(){return this.isconstant()==false};function Evaluatable(){}Evaluatable.prototype=Object.create(Constantable.prototype);Evaluatable.prototype.onevaluate=null;Evaluatable.prototype.onevaluatearg=null;Evaluatable.prototype.onevaluatedata=null;function evaluate(a){if(a instanceof Evaluatable==false){throw new Error(""+a+" is not evaluatable")}return a.evaluate.apply(a,arguments)}function evaluatearg(a){if(a instanceof Evaluatable==false){throw new Error(""+a+" is not evaluatable")}return a.evaluatearg.apply(a,arguments)}function evaluatedata(a){if(a instanceof Evaluatable==false){throw new Error(""+a+" is not evaluatable")}return a.evaluatedata.apply(a,arguments)}function beforeevaluate(b){return function a(){return b.apply(this,slice(arguments).map(evaluate))}}function beforeevaluatearg(b){return function a(){return b.apply(this,slice(arguments).map(evaluatearg))}}function beforeevaluatedata(a){return function b(){return a.apply(this,slice(arguments).map(evaluatedata))}}function afterevaluate(a){return function b(){return a.apply(this,arguments).evaluate()}}function afterevaluatearg(b){return function a(){return b.apply(this,arguments).evaluatearg()}}function afterevaluatedata(b){return function a(){return b.apply(this,slice(arguments).map(evaluatedata))}}Evaluatable.prototype.evaluate=function(){if(this.onevaluate==null){throw new Error(""+this+" onevaluate was not defined.")}return this.onevaluate.apply(this,arguments)};Evaluatable.prototype.evaluatearg=function(){if(this.onevaluatearg==null){throw new Error(""+this+" onevaluatearg was not defined.")}return this.onevaluatearg()};Evaluatable.prototype.evaluatedata=function(){if(this.onevaluatedata==null){return this.evaluatearg()}return this.onevaluatedata()};Evaluatable.prototype.willevaluate=function(){var a=this;return function b(){return a.evaluate.apply(a,arguments)}};Evaluatable.prototype.willevaluatearg=function(){var a=this;return function b(){return a.evaluatearg.apply(a,arguments)}};function Expandable(){}Expandable.prototype=Object.create(Evaluatable.prototype);Expandable.prototype.onexpand=null;Expandable.prototype.onexpandarg=null;Expandable.prototype.onexpanddata=null;function expand(a){if(a instanceof Expandable==false){throw new Error(""+a+" is not expandable")}return a.expand.apply(a,arguments)}function expandarg(a){if(a instanceof Expandable==false){throw new Error(""+a+" is not expandable")}return a.expandarg.apply(a,arguments)}function expanddata(a){if(a instanceof Expandable==false){throw new Error(""+a+" is not expandable")}return a.expanddata.apply(a,arguments)}function beforeexpand(a){return function b(){return a.apply(this,slice(arguments).map(expand))}}function beforeexpandarg(a){return function b(){return a.apply(this,slice(arguments).map(expandarg))}}function beforeexpanddata(a){return function b(){return a.apply(this,slice(arguments).map(expanddata))}}function afterexpand(a){return function b(){return a.apply(this,arguments).expand()}}function afterexpandarg(a){return function b(){return a.apply(this,arguments).expandarg()}}function afterexpanddata(b){return function a(){return b.apply(this,arguments).expanddata()}}Expandable.prototype.expand=function(){if(this.onexpand==null){throw new Error(""+this+" onexpand was not defined.")}return this.onexpand.apply(this,arguments)};Expandable.prototype.expandarg=function(){if(this.onexpandarg==null){throw new Error(""+this+"onexpandarg was not defined.")}return this.onexpandarg()};Expandable.prototype.expanddata=function(){if(this.onexpanddata==null){return this.expandarg()}return this.onexpanddata()};Expandable.prototype.willexpand=function(){var b=this;return function a(){return b.expand.apply(b,arguments)}};Expandable.prototype.willexpandarg=function(){var a=this;return function b(){return a.expandarg.apply(a,arguments)}};Expandable.prototype.willexpanddata=function(){var b=this;return function a(){return b.expanddata.apply(b,arguments)}};function Expanded(a){this.value=a||""}Expanded.prototype=Object.create(Expandable.prototype);Expanded.prototype.toString=function(){return this.value};Expanded.prototype.expand=function(){return new Expanded(this.value+"("+slice(arguments).map(expandarg).join(",")+")")};Expanded.prototype.onevaluatearg=function(){return this};Expanded.prototype.onexpandarg=function(){return this};Expanded.prototype.unpack=function(){return this.value};function unpack(a){if(a instanceof Expanded==false){throw new Error("some is not expanded.")}return a.unpack()}function AtomClass(a){this.value=a}AtomClass.prototype=Object.create(Expandable.prototype);AtomClass.prototype.toString=function(){return this.value.toString()};AtomClass.prototype.valueOf=function(){return this.toString()};AtomClass.prototype.onevaluatearg=function(){return this};AtomClass.prototype.onevaluatedata=function(){return this};AtomClass.prototype.onexpandarg=function(){return new Expanded(this.toString())};AtomClass.prototype.status=function(){return true};AtomClass.prototype.clone=function(){return this};function value(a){if(a instanceof AtomClass==false){throw new Error(""+a+" is not atom class.")}return a.value}function tostring(a){if(a instanceof AtomClass==false){throw new Error(""+a+" is not atom class.")}return a.toString()}function clone(a){if(a instanceof AtomClass==false){throw new Error(""+a+" is not atom class.")}return a.clone()}function beforeclone(b){return function a(){return b.apply(b,slice(arguments).map(clone))}}function afterclone(b){return function a(){return b.apply(b,arguments).clone()}}function BooleanClass(a){this.value=a}BooleanClass.prototype=Object.create(AtomClass.prototype);BooleanClass.prototype.status=function(){return this.value};var t=new BooleanClass(true);var f=new BooleanClass(false);function IteratorClass(){}IteratorClass.prototype=Object.create(AtomClass.prototype);IteratorClass.prototype.isdie=function(){throw new Error("isdie was not defined.")};IteratorClass.prototype.isalive=function(){throw new Error("isalive was not defined.")};IteratorClass.prototype.next=function(){throw new Error("next was not defined.")};IteratorClass.prototype.count=function(){throw new Error("count was not defined.")};function IterationClass(){}IterationClass.prototype.every=function(){};IterationClass.prototype.map=function(){};IterationClass.prototype.filter=function(){};IterationClass.prototype.reduce=function(){};IterationClass.prototype.findif=function(){};IterationClass.prototype.positionif=function(){};function ArrayIterationClass(a){this.array=a;this.index=0}function ConsIteratorClass(a){this.index=0;this.value=a}ConsIteratorClass.prototype=Object.create(IteratorClass.prototype);ConsIteratorClass.prototype.isdie=function(){return this.isalive()==false};ConsIteratorClass.prototype.isalive=function(){return this.value.status()};ConsIteratorClass.prototype.next=function(){if(this.isdie()){return null}var a=this.value.car;this.value=this.value.cdr;this.index++;return a};ConsIteratorClass.prototype.count=function(){return this.index};function ArrayIteratorClass(a){this.index=0;this.value=a}ArrayIteratorClass.prototype=Object.create(IteratorClass.prototype);ArrayIteratorClass.prototype.isdie=function(){return this.isalive()==false};ArrayIteratorClass.prototype.isalive=function(){return this.index<this.value.length()};ArrayIteratorClass.prototype.next=function(){if(this.isdie()){return null}var a=this.value.nth(this.index);this.index++;return a};ArrayIteratorClass.prototype.count=function(){return this.index};function ReferenceClass(){}ReferenceClass.prototype=Object.create(AtomClass.prototype);ReferenceClass.prototype.toString=function(){return this.get().toString()};ReferenceClass.prototype.get=function(){throw new Error("get was not defined.")};ReferenceClass.prototype.set=function(){throw new Error("set was not defined.")};ReferenceClass.prototype.onevaluatearg=function(){return this.get()};ReferenceClass.prototype.onevaluate=null;ReferenceClass.prototype.onexpand=null;ReferenceClass.prototype.onexpandarg=null;function ArrayReferenceClass(b,a){this.value=b||null;this.index=a}ArrayReferenceClass.prototype=Object.create(ReferenceClass.prototype);ArrayReferenceClass.prototype.get=function(){return this.value.evaluatedata().get(this.index)};ArrayReferenceClass.prototype.set=function(a){return this.value.evaluatedata().set(this.index,a)};ArrayReferenceClass.prototype.onexpanddata=function(){return new Expanded(this.value.expanddata().unpack()+"["+this.index+"]")};function ConsReferenceClass(a){this.value=a||null}ConsReferenceClass.prototype=Object.create(ConsReferenceClass.prototype);ConsReferenceClass.prototype.get=function(){return this.value.car};ConsReferenceClass.prototype.set=function(a){this.value.car=a;return a};function NilReferenceClass(a){}NilReferenceClass.prototype=Object.create(ReferenceClass.prototype);NilReferenceClass.prototype.get=function(){return nil};NilReferenceClass.prototype.set=function(){throw new Error("nil reference could not assign.")};var nilf=new NilReferenceClass();function SymbolReferenceClass(){}SymbolReferenceClass.prototype=Object.create(ReferenceClass.prototype);function SymbolValueReferenceClass(a){this.value=a||null}SymbolValueReferenceClass.prototype=Object.create(SymbolReferenceClass.prototype);SymbolValueReferenceClass.prototype.get=function(){return this.value.getvaluee()};SymbolValueReferenceClass.prototype.set=function(a){return this.value.setvalue(a)};SymbolValueReferenceClass.prototype.onexpandarg=function(){return new Expanded(this.value.getvaluename())};function SymbolFunctionReferenceClass(a){this.value=a||null}SymbolFunctionReferenceClass.prototype=Object.create(SymbolReferenceClass.prototype);SymbolFunctionReferenceClass.prototype.get=function(){return this.value.getfunce()};SymbolFunctionReferenceClass.prototype.set=function(a){return this.value.setfunc(a)};SymbolFunctionReferenceClass.prototype.onexpandarg=function(){return new Expanded(this.value.getfuncname())};function NumberClass(a){this.value=a}NumberClass.prototype=Object.create(AtomClass.prototype);NumberClass.prototype.clone=function(){return new NumberClass(this.value)};function IntClass(a){this.value=a}IntClass.prototype=Object.create(NumberClass.prototype);IntClass.prototype.toString=function(){return"("+this.value.toString()+"|0)"};IntClass.prototype.clone=function(){return new IntClass(this.value)};function CharClass(a){this.value=a}CharClass.prototype=Object.create(IntClass.prototype);CharClass.prototype.toString=function(){return String.fromCharCode(this.value)};CharClass.prototype.clone=function(){return new CharClass(this.value)};function atoi(a){return a.charCodeAt()}function atoc(a){return new CharClass(atoi(a))}function SequencialClass(){}SequencialClass.prototype=Object.create(AtomClass.prototype);SequencialClass.prototype.get=function(){throw new Error("get was not defined.")};SequencialClass.prototype.set=function(){throw new Error("set was not defined.")};SequencialClass.prototype.toArray=function(){throw new Error("toArray was not defined.")};SequencialClass.prototype.toPlain=function(){throw new Error("toPlain was not defined.")};SequencialClass.prototype.every=function(){throw new Error("every was not defined.")};SequencialClass.prototype.map=function(){throw new Error("map was not defined.")};SequencialClass.prototype.filter=function(){throw new Error("filter was not defined.")};SequencialClass.prototype.reduce=function(){throw new Error("reduce was not defined.")};SequencialClass.prototype.findif=function(){throw new Error("findif was not defined.")};SequencialClass.prototype.positionif=function(){throw new Error("positionif was not defined.")};SequencialClass.prototype.reverse=function(){throw new Error("reverse was not defined.")};SequencialClass.prototype.concat=function(){throw new Error("concat was not defined.")};SequencialClass.prototype.slice=function(){throw new Error("slice was not defined.")};SequencialClass.prototype.copy=function(){throw new Error("clone was not defined.")};SequencialClass.prototype.nth=function(){throw new Error("nth was not defined.")};SequencialClass.prototype.last=function(){throw new Error("last was not defined.")};SequencialClass.prototype.length=function(){throw new Error("length was not defined.")};SequencialClass.prototype.iter=function(){throw new Error("iter was not defined.")};SequencialClass.prototype.push=function(){throw new Error("push was not defined.")};SequencialClass.prototype.pop=function(){throw new Error("pop was not defined.")};function ArrayClass(a){this.value=a}ArrayClass.prototype=Object.create(SequencialClass.prototype);ArrayClass.prototype.get=function(a){return this.value[a]};ArrayClass.prototype.set=function(a,b){this.value[a]=b;return b};ArrayClass.prototype.toArray=function(){return this.value};ArrayClass.prototype.toPlain=function(){return this.value.join(",")};ArrayClass.prototype.iter=function(){return new ArrayIteratorClass(this)};ArrayClass.prototype.every=function(a){this.value.every(a.willevaluate);return nil};ArrayClass.prototype.map=function(a){return new ArrayClass(this.value.map(a.willevaluate))};ArrayClass.prototype.filter=function(a){return new ArrayClass(this.value.filter(a.willevaluate))};ArrayClass.prototype.reduce=function(a){return new ArrayClass(this.value.reduce(a.willevaluate))};ArrayClass.prototype.findif=function(b){var a,c;for(c=null,a=0;a<this.length();a++){if((c=this.nth(a)).status()){return c}}return nil};ArrayClass.prototype.positionif=function(c){var a,b;for(b=0,a=0;a<this.length();a++,b++){if(this.nth(a).status()){return b}}return nil};ArrayClass.prototype.nth=function(a){return new ArrayReferenceClass(this,a)};ArrayClass.prototype.last=function(){return this.length()==0?nil:this.nth(this.length()-1)};ArrayClass.prototype.length=function(){return this.value.length};ArrayClass.prototype.reverse=function(){this.value.reverse();return this};ArrayClass.prototype.copy=function(){return new ArrayClass(this.value.slice())};ArrayClass.prototype.push=function(a){return this.value.push(a)};ArrayClass.prototype.pop=function(){return this.value.pop()};function ClassArrayClass(b,a){this.value=b;this.classe=a}ClassArrayClass.prototype=Object.create(ArrayClass.prototype);function StringClass(a){this.value=a||[]}StringClass.prototype=Object.create(ClassArrayClass.prototype);StringClass.prototype.onevaluate=null;StringClass.prototype.onexpand=null;StringClass.prototype.onevaluatearg=function(){return this};StringClass.prototype.toString=function(){return'"'+this.value.join("")+'"'};StringClass.prototype.toPlain=function(){return this.value.join("")};StringClass.prototype.copy=function(){return new StringClass(this.value.slice())};function string(a){return new StringClass(slice(a).map(atoc))}function ConsClass(a,b){this.car=a||nil;this.cdr=b||nil}ConsClass.prototype=Object.create(SequencialClass.prototype);ConsClass.prototype.onexpand=function(){var a=this.expandarg();return a.expand.apply(a,arguments)};ConsClass.prototype.onevaluate=function(){var a=this.evaluatearg();return a.evaluate.apply(a,arguments)};ConsClass.prototype.onexpandarg=function(){var b=this.car;var a=this.cdr.toArray();return b.expand.apply(b,a)};ConsClass.prototype.onevaluatearg=function(){var b=this.car;var a=this.cdr.toArray();return b.evaluate.apply(b,a)};ConsClass.prototype.onexpanddata=function(){return new Expanded(this.toString())};ConsClass.prototype.toPlain=function(){return this.toArray().join(",")};ConsClass.prototype.toString=function(){return"["+this.toArray().join(",")+"]"};ConsClass.toCons=function(c){var a,b;for(a=nil,b=0;b<c.length;b++){a=new ConsClass(c[b],a)}return a.reverse()};ConsClass.prototype.toCons=function(){return this};ConsClass.prototype.clone=function(){var b,a;for(b=nil,a=this;a!=nil;a=a.cdr){if(a.car instanceof UnQuoteAtClass){var d,c;for(d=a.car.evaluatearg(),c=d;c!=nil&&c.cdr!=nil;c=c.cdr){}c.cdr=b;b=d}else{if(a.car instanceof UnQuoteClass){b=new ConsClass(a.car.evaluatearg(),b)}else{b=new ConsClass(a.car,b)}}}return b.reverse()};ConsClass.prototype.toArray=function(){this.shouldlinear();var b,a;for(b=[],a=this;a!=nil;a=a.cdr){b.push(a.car)}return b};ConsClass.prototype.iter=function(){return new ConsIteratorClass(this)};ConsClass.prototype.every=function(b){var a;for(a=this;a!=nil;a=a.cdr){b.evaluate(a.car)}return nil};ConsClass.prototype.map=function(c){var b,a;for(b=nil,a=this;a!=nil;a=a.cdr){b=new ConsClass(c.evaluate(a.car),b)}return b.reverse()};ConsClass.prototype.filter=function(c){var b,a;for(b=nil,a=this;a!=nil;a=a.cdr){if(c.evaluate(a.car)){b=new ConsClass(a.car,b)}}return b.reverse()};ConsClass.prototype.reduce=function(c){if(this.length()==0){return nil}if(this.length()==1){return this.car}var b,a;for(b=a.car,a=this;a!=nil;a=a.cdr){b=c.evaluate(b,a.car)}return b};ConsClass.prototype.findif=function(b){var a;for(a=this;a!=nil;a=a.cdr){if(b.evaluate(a.car)){return a.car}}return nil};ConsClass.prototype.positionif=function(c){var b,a;for(b=0,a=this;a!=nil;a=a.cdr,b++){if(c.evaluate(a.car)){return b}}return null};ConsClass.prototype.nth=function(b){var a;for(a=this;a!=nil&&b;a=a.cdr){}return new ConsReferenceClass(a)};ConsClass.prototype.last=function(){var a;for(a=this;a!=nil&&a.cdr!=nil;a=a.cdr){}return a.car};ConsClass.prototype.length=function(){var b,a;for(a=this;a!=nil;a=a.cdr){b++}return b};ConsClass.prototype.reversesafe=function(){var b,a;for(b=nil,a=this;a!=nil;a=a.cdr){b=new ConsClass(a.car,b)}return b};ConsClass.prototype.reverse=function(){var a,c,b;for(a=this,b=nil;a!=nil;){c=a.cdr;a.cdr=b;b=a;a=c}return b};ConsClass.prototype.copy=function(){var b,a;for(b=nil,a=this;a;a=a.cdr){b=new ConsClass(a.car,b)}return b.reverse()};ConsClass.prototype.islinear=function(){var a;for(a=this;a!=nil;a=a.cdr){if(a.cdr!=nil&&a.cdr instanceof ConsClass==false){return false}}return true};ConsClass.prototype.shouldlinear=function(){if(this.islinear()==false){throw ("list should be linear.")}};function NilClass(){}NilClass.prototype=Object.create(ConsClass.prototype);NilClass.prototype.car=nil;NilClass.prototype.cdr=nil;NilClass.prototype.onevaluatearg=function(){return this};NilClass.prototype.onexpandarg=function(){return new Expanded(this.toString())};NilClass.prototype.onevaluate=NilClass.prototype.onevaluatearg;NilClass.prototype.onexpand=NilClass.prototype.onexpandarg;NilClass.prototype.status=function(){return false};NilClass.prototype.toString=function(){return"null"};NilClass.prototype.toArray=function(){return[]};NilClass.prototype.every=function(a){return nil};NilClass.prototype.map=function(a){return nil};NilClass.prototype.filter=function(a){return nil};NilClass.prototype.reduce=function(a){return nil};NilClass.prototype.findif=function(a){return nil};NilClass.prototype.positionif=function(a){return nil};NilClass.prototype.nth=function(a){return nil};NilClass.prototype.length=function(){return 0};NilClass.prototype.reverse=function(){return this};var nil=new NilClass();function ConsStackClass(a,b){this.car=a||nil;this.cdr=b||nil}ConsStackClass.prototype=Object.create(ConsClass.prototype);ConsStackClass.prototype.push=function(b){var a=new ConsClass(b);if(this.car==nil){this.car=a;this.cdr=a}else{this.cdr.cdr=a}return b};ConsStackClass.prototype.pop=function(){if(this.car==nil){return nil}var a=this.car.car;this.car=this.car.cdr;return a};ConsStackClass.prototype.iter=function(){return this.car.iter()};function QuoteFamilyClass(a){this.value=a}QuoteFamilyClass.prototype=Object.create(AtomClass.prototype);function QuoteClass(a){this.value=a}QuoteClass.prototype=Object.create(QuoteFamilyClass.prototype);QuoteClass.prototype.toString=function(){return"/*--quote--*/"+this.value.toString()};QuoteClass.prototype.onevaluate=function(){return this.value.evaluate(this.value,arguments)};QuoteClass.prototype.onexpand=function(){return this.value.expand(this.value,arguments)};QuoteClass.prototype.onevaluatearg=function(){return this.value.clone()};QuoteClass.prototype.onexpandarg=function(){return this.value.expanddata()};function UnQuoteClass(a){this.value=a}UnQuoteClass.prototype=Object.create(QuoteFamilyClass.prototype);UnQuoteClass.prototype.onevaluate=null;UnQuoteClass.prototype.onexpand=null;UnQuoteClass.prototype.toString=function(){return"/*--unquote--*/"+this.value.toString()};UnQuoteClass.prototype.onevaluatearg=function(){return this.value.evaluatearg()};UnQuoteClass.prototype.onexpandarg=function(){return this.value.expandarg()};function UnQuoteAtClass(a){this.value=a}UnQuoteAtClass.prototype=Object.create(UnQuoteClass.prototype);UnQuoteAtClass.prototype.toString=function(){return"/*--unquoteat--*/"+this.value.toString()};function CallableClass(){}CallableClass.prototype=Object.create(AtomClass.prototype);CallableClass.prototype.label="<#callable class>";CallableClass.prototype.toString=function(){return this.label};function FunctionClass(){}FunctionClass.prototype=Object.create(CallableClass.prototype);FunctionClass.prototype.label="<#function class>";function SpecialFunctionClass(){}SpecialFunctionClass.prototype=Object.create(FunctionClass.prototype);SpecialFunctionClass.label="<#special function class>";function OptimizeFunctionClass(){}OptimizeFunctionClass.prototype=Object.create(FunctionClass.prototype);OptimizeFunctionClass.prototype.label="<#optimize function class>";function isoptimizable(a){return a instanceof Expanded==false||a instanceof SymbolFamilyClass==false||a.isconstant()==false}function isoptimizableall(b){var a;for(a=0;a<b.length;a++){if(isoptimizable(b[a])==false){return false}}return true}function ReduceOptimizeFunctionClass(a,c,b){this.func=a||null;this.evaluatedefault=c||null;this.expanddefault=b||null}ReduceOptimizeFunctionClass.prototype=Object.create(OptimizeFunctionClass.prototype);ReduceOptimizeFunctionClass.prototype.evaluate=beforeevaluatearg(OptimizeFunctionClass.prototype.evaluate);ReduceOptimizeFunctionClass.prototype.expand=beforeevaluatearg(OptimizeFunctionClass.prototype.expand);ReduceOptimizeFunctionClass.prototype.onevaluate=function(){if(arguments.length==0){return this.evaluatedefault}if(arguments.length==1){return arguments[0]}var b,a;for(b=arguments[0],a=1;a<arguments.length;a++){b=this.func.evaluate(b,arguments[a])}return b};ReduceOptimizeFunctionClass.prototype.onexpand=function(){if(arguments.length==0){return this.expanddefault}if(arguments.length==1){return arguments[0]}var d,a;for(d=[arguments[0]],a=1;a<arguments.length;a++){if(isoptimizable(d[d.length-1])==false||isoptimizable(arguments[a])==false){d.push(arguments[a])}else{d[d.length-1]=d[d.length-1]=this.func.evaluate(d[d.length-1],arguments[a])}}var c,b;for(c="",b=0;b<d.length;b++){c+=(b?"+":"")+d[b]}return new Expanded(c)};ReduceOptimizeFunctionClass.prototype.expandarg=function(){return new Expanded("function(){Array.prototype.slice.call(arguments).reduce("+this.func.expandarg()+");}")};function PrimitiveFunctionClass(){}PrimitiveFunctionClass.prototype=Object.create(FunctionClass.prototype);PrimitiveFunctionClass.prototype.evaluate=beforeevaluatearg(FunctionClass.prototype.evaluate);PrimitiveFunctionClass.prototype.expand=beforeexpandarg(FunctionClass.prototype.expand);PrimitiveFunctionClass.prototype.label="<#primitive function class>";function UserFunctionClass(b,a,c){this.name=b||null;this.args=a||null;this.rest=c||null}UserFunctionClass.prototype=Object.create(FunctionClass.prototype);UserFunctionClass.prototype.toString=function(){return"<#user function class>"};UserFunctionClass.prototype.onevaluate=function(){var a,c,b;for(a=new ConsClass(synprogn),c=this.args.iter(),b=0;c.isalive()&&b<arguments.length;b++){a=new ConsClass(new ConsClass(macdeflvar,new ConsClass(c.next(),new ConsClass(arguments[b]))),a)}a=a.reverse();return new ConsClass(synblock_func,new ConsClass(a,new ConsClass(this.rest))).evaluatearg()};UserFunctionClass.prototype.onexpandarg=function(){return new Expanded("function("+this.args.toArray().map(getvaluename).join(",")+"){"+new ConsClass(synblock_func,new ConsClass(this.rest.expandarg())).expandarg()+"}")};function MacroClass(){}function PrimitiveMacroClass(){}function UserMacroClass(b,a,c){this.name=b||null;this.args=a||null;this.rest=c||null}MacroClass.prototype=Object.create(CallableClass.prototype);MacroClass.prototype.evaluate=afterevaluatearg(CallableClass.prototype.evaluate);MacroClass.prototype.expand=afterexpandarg(CallableClass.prototype.evaluate);PrimitiveMacroClass.prototype=Object.create(MacroClass.prototype);UserMacroClass.prototype=Object.create(MacroClass.prototype);UserMacroClass.prototype.onevaluate=UserFunctionClass.prototype.onevaluate;function SymbolFamilyClass(){}SymbolFamilyClass.prototype=Object.create(AtomClass.prototype);SymbolFamilyClass.prototype.getvalue=function(){throw new Error("getvalue was not defined.")};SymbolFamilyClass.prototype.getfunc=function(){throw new Error("getfunc was not defined.")};SymbolFamilyClass.prototype.setvalue=function(){throw new Error("setvalue was not defined.")};SymbolFamilyClass.prototype.setfunc=function(){throw new Error("setfunc was not defined.")};function SymbolClass(a,c,b){this.name=a?a.copy():null;this.value=c||null;this.func=b||null}SymbolClass.prototype=Object.create(SymbolFamilyClass.prototype);SymbolClass.prototype.toString=function(){return this.name.toPlain()};SymbolClass.prototype.getvalue=function(){return this.value};SymbolClass.prototype.getfunc=function(){return this.func};SymbolClass.prototype.getvaluee=function(){if(this.getvalue()==null){throw new Error("symbol "+this+" has no value.")}return this.getvalue()};SymbolClass.prototype.getfunce=function(){if(this.getfunc()==null){throw new Error("symbol "+this+" has no func.")}return this.getfunc()};SymbolClass.prototype.setvalue=function(a){this.value=a;return a};SymbolClass.prototype.setfunc=function(a){this.func=a;return a};SymbolClass.prototype.onevaluate=function(){var a=this.getfunce();return a.evaluate.apply(a,arguments)};SymbolClass.prototype.onevaluatearg=function(){return this.getvaluee()};SymbolClass.prototype.onexpand=function(){var a=this.getfunce();return a.expand.apply(a,arguments)};SymbolClass.prototype.onexpandarg=function(){return new Expanded(this.toString())};function InternSymbolClass(a){this.name=a?a.copy():null}InternSymbolClass.prototype=Object.create(SymbolFamilyClass.prototype);InternSymbolClass.prototype.toString=function(){return this.name.toPlain()};InternSymbolClass.prototype.getvalue=function(){return inp.scope.finde(this.name).getvaluee()};InternSymbolClass.prototype.getfunc=function(){return inp.scope.finde(this.name).getfunce()};InternSymbolClass.prototype.setvalue=function(a){return inp.scope.finde(this.name).setvalue(a)};InternSymbolClass.prototype.setfunc=function(a){return inp.scope.finde(this.name).setfunc(a)};InternSymbolClass.prototype.onevaluate=function(){var a=inp.scope.finde(this.name);return a.evaluate.apply(a,arguments)};InternSymbolClass.prototype.onexpand=function(){var a=inp.scope.finde(this.name);return a.expand.apply(a,arguments)};InternSymbolClass.prototype.onevaluatearg=function(){var a=inp.scope.finde(this.name);return a.evaluatearg.apply(a,arguments)};InternSymbolClass.prototype.onexpandarg=function(){var a=inp.scope.finde(this.name);return a.expandarg.apply(a,arguments)};InternSymbolClass.prototype.getvaluename=function(){return inp.scope.finde(this.name).getvaluename()};InternSymbolClass.prototype.getfuncname=function(){return inp.scope.finde(this.name).getfuncname()};function VariableSymbolClass(a,c,b){this.name=a?a.copy():null;this.value=c||null;this.func=b||null;this.valuename=null;this.funcname=null}VariableSymbolClass.prototype=Object.create(SymbolClass.prototype);VariableSymbolClass.prototype.toString=function(){return this.getvaluename()};VariableSymbolClass.prototype.toString=function(){return this.getvaluename()+"/*--"+this.name+"--*/"};VariableSymbolClass.prototype.getvaluename=function(){if(this.valuename==null){this.valuename=inp.namegen.generate()}return this.valuename};VariableSymbolClass.prototype.getfuncname=function(){if(this.funcname==null){this.funcname=inp.namegen.generate()}return this.funcname};VariableSymbolClass.prototype.onexpandarg=function(){return new Expanded(this.getvaluename())};VariableSymbolClass.prototype.onexpand=function(){var a=this.getfunc();if(a==null||a instanceof UserFunctionClass){return new Expanded(this.getfuncname()+"("+slice(arguments).map(expandarg).join(",")+")")}return a.expand.apply(a,arguments)};function getvaluename(a){if(a instanceof SymbolFamilyClass==false){throw new Error("some is not symbol family class.")}return a.getvaluename()}function getfuncname(a){if(a instanceof SymbolFamilyClass==false){throw new Error("some is not symbol family class.")}return a.getfuncname()}function StreamClass(a){this.direction=a}StreamClass.prototype=Object.create(AtomClass.prototype);StreamClass.direction={};StreamClass.direction.input=(1|0);StreamClass.direction.output=(2|0);StreamClass.onevaluate=null;StreamClass.onexpand=null;StreamClass.onexpandarg=null;StreamClass.onexpanddata=null;StreamClass.prototype.iseof=function(){throw new Error("iseof was not defined.")};StreamClass.prototype.isalive=function(){throw new Error("isalive was not defined.")};StreamClass.prototype.look=function(){throw new Error("look was not defined.")};StreamClass.prototype.get=function(){throw new Error("get was not defined.")};StreamClass.prototype.put=function(){throw new Error("put was not defined.")};StreamClass.prototype.isin=function(){return new Boolean(this.direction&StreamClass.direction.input)};StreamClass.prototype.isout=function(){return new Boolean(this.direction&StreamClass.direction.output)};StreamClass.prototype.shouldin=function(){if(this.isin()==false){throw new Error("stream should input direction!")}};StreamClass.prototype.shouldout=function(){if(this.isout()==false){throw new Error("stream should output direction!")}};function StringStreamClass(b,a){this.direction=b;this.source=a;this.sourceout=new StringClass();this.index=0}StringStreamClass.prototype=Object.create(StreamClass.prototype);StringStreamClass.prototype.iseof=function(){this.shouldin();return this.source.length()<=this.index};StringStreamClass.prototype.isalive=function(){this.shouldin();return this.iseof()==false};StringStreamClass.prototype.look=function(){this.shouldin();return this.iseof()?nilf:this.source.nth(this.index)};StringStreamClass.prototype.get=function(){this.shouldin();return this.iseof()?nilf:this.source.nth(this.index++)};StringStreamClass.prototype.put=function(a){this.shouldout();return this.source.push(a)};function Obarray(){this.obarray={}}Obarray.prototype.find=function(a){return this.obarray[a.toPlain()]||null};Obarray.prototype.set=function(b,a){this.obarray[b.toPlain()]=a;return a};Obarray.prototype.intern=function(b){var c;if((c=this.find(b))){return c}var a=new VariableSymbolClass(b);return this.set(b,a)};Obarray.prototype.list=function(){var c,b,a;for(c=[],b=Object.keys(this.obarray),a=0;a<b.length;a++){c.push(this.obarray[b[a]])}return c};Obarray.prototype.internsym=function(a){if(a instanceof InternSymbolClass==false){return a}return this.intern(a.name)};Obarray.prototype.internsymf=function(a){if(a instanceof InternSymbolClass==false){return a}return this.internf(a.name)};function Obarrays(a){this.obarray=new Obarray();this.parent=a||null}Obarrays.prototype.list=function(){var b,a;for(b=[],a=this;a;a=a.parent){b=b.concat(a.obarray.list())}return b};Obarrays.prototype.find=function(a){var c,b;for(c=this;c;c=c.parent){if((b=c.obarray.find(a))){return b}}return null};Obarrays.prototype.finde=function(a){var b;if((b=this.find(a))==null){throw new Error("obarrays "+a+" was not found.")}return b};Obarrays.prototype.intern=function(a){var b;if((b=this.find(a))){return b}return this.obarray.intern(a)};Obarrays.prototype.internf=function(a){return this.obarray.intern(a)};Obarrays.prototype.internsym=Obarray.prototype.internsym;Obarrays.prototype.internsymf=Obarray.prototype.internsymf;Obarrays.prototype.nest=function(){return new Obarrays(this)};Obarrays.prototype.exit=function(){return this.parent};function Obscope(a){this.obarray=new Obarrays(null);this.parent=a||null}Obscope.prototype.list=function(){var b,a;for(b=[],a=this;a;a=a.parent){b=b.concat(a.listin())}return b};Obscope.prototype.listin=function(){return this.obarray.list()};Obscope.prototype.find=function(a){var b,c;for(c=this;c;c=c.parent){if((b=c.obarray.find(a))){return b}}return null};Obscope.prototype.finde=function(a){var b=this.find(a);if(b){return b}throw new Error("obscope "+a+" was not found.")};Obscope.prototype.intern=function(a){var b=this.find(a);if(b){return b}return this.obarray.intern(a)};Obscope.prototype.internf=function(a){return this.obarray.internf(a)};Obscope.prototype.internsym=Obarrays.prototype.internsym;Obscope.prototype.internsymf=Obarrays.prototype.internsymf;Obscope.prototype.nestin=function(){this.obarray=this.obarray.nest()};Obscope.prototype.exitin=function(){this.obarray=this.obarray.exit()};Obscope.prototype.nest=function(){return new Obscope(this)};Obscope.prototype.exit=function(){return this.parent};function ReaderScope(a){this.scope={};this.method=a||null}ReaderScope.prototype.get=function(a){return this.scope[a.toString()]||null};ReaderScope.prototype.getcurrent=function(){return this.method||null};ReaderScope.prototype.dig=function(a){if(this.scope[a.toString()]==null){this.scope[a.toString()]=new ReaderScope()}return this.scope[a.toString()]};ReaderScope.prototype.set=function(a,b){return this.dig(a).setcurrent(b)};ReaderScope.prototype.setcurrent=function(a){return this.method=a};function Interpreter(){this.scope=new Obscope();this.scoperoot=this.scope;this.readerscope=new ReaderScope();this.namegen=new NameGenerator("abcdefghijklmnopqrstuvwxyz")}Interpreter.prototype.nestin=function(){inp.scope.nestin();return null};Interpreter.prototype.exitin=function(){inp.scope.exitin();return null};Interpreter.prototype.nest=function(){this.scope=this.scope.nest();return null};Interpreter.prototype.exit=function(){this.scope=this.scope.exit();return null};var inp=new Interpreter();inp.scope.intern(string("nil")).setvalue(nil);inp.scope.intern(string("t")).setvalue(t);var rdignoreindent=new PrimitiveFunctionClass();var rdread=new PrimitiveFunctionClass();var rdreadintern=new PrimitiveFunctionClass();var rdreadminus=new PrimitiveFunctionClass();var rdreadnumber=new PrimitiveFunctionClass();var rdreadstring=new PrimitiveFunctionClass();var rdreadopenbrace=new PrimitiveFunctionClass();var rdreadclosebrace=new PrimitiveFunctionClass();var rdreadclosebrace_unique=new Unique();var rdreadquote=new PrimitiveFunctionClass();var rdreadunquote=new PrimitiveFunctionClass();var rdreadunquoteat=new PrimitiveFunctionClass();var rdreadchar=new PrimitiveFunctionClass();var rdreadpre=new PrimitiveFunctionClass();rdignoreindent.onevaluate=function(a){while(a.isalive()&&a.look().get().value==" ".charCodeAt()||a.look().get().value=="\t".charCodeAt()){a.get()}return nil};rdread.onevaluate=function(e){rdignoreindent.evaluate(e);var d,c;var b,a;for(d=inp.readerscope,b=nil;e.isalive();){a=e.look();c=d.get(a);if(c==null){break}b=e.get();d=c}if(d.getcurrent()==null){throw new Error("method was not found.")}return d.getcurrent().evaluate(e,b)};rdreadintern.onevaluate=function(b){rdignoreindent.evaluate(b);var a;for(a=new StringClass();b.isalive();){if(inp.readerscope.get(b.look())||b.look().get().value==(" ".charCodeAt())||b.look().get().value==("\t".charCodeAt())){break}else{a.push(b.get())}}if(a.length()==0){return nil}inp.scoperoot.intern(a);return new InternSymbolClass(a)};rdreadminus.onevaluate=function(b){var a=rdread.evaluate(b);a.value*=-1;return a};rdreadnumber.onevaluate=function(c,d){var b,a;for(a=d.toString();c.isalive();){if("123456890.".indexOf(c.look().toString())>=0){a+=c.get().toString()}else{break}}return a.indexOf(".")>=0?new NumberClass(parseFloat(a)).constant():new IntClass(parseInt(a)).constant()};rdreadstring.onevaluate=function(d,a){var c,b;for(b=new StringClass();d.isalive()&&(c=d.get()).status();){if(c.get().value==a.value){break}else{b.push(c)}}return b.constant()};rdreadopenbrace.onevaluate=function(c){var a,b;for(a=nil;c.isalive()&&(b=rdread.evaluate(c))!=rdreadclosebrace_unique;){a=new ConsClass(b,a)}return a.reverse().constant()};rdreadclosebrace.onevaluate=function(a){return rdreadclosebrace_unique};rdreadquote.onevaluate=function(a){return new QuoteClass(rdread.evaluate(a))};rdreadunquote.onevaluate=function(a){return new UnQuoteClass(rdread.evaluate(a))};rdreadunquoteat.onevaluate=function(a){return new UnQuoteAtClass(rdread.evaluate(a))};rdreadchar.onevaluate=function(a){return new CharClass(a.get())};rdreadpre.onevaluate=function(a){var b=rdread.evaluate(a);return b.evaluatearg()};inp.readerscope.setcurrent(rdreadintern);inp.readerscope.dig("'").setcurrent(rdreadquote);inp.readerscope.dig(",").setcurrent(rdreadunquote);inp.readerscope.dig(",").dig("@").setcurrent(rdreadunquoteat);inp.readerscope.dig("-").setcurrent(rdreadminus);inp.readerscope.dig('"').setcurrent(rdreadstring);inp.readerscope.dig("(").setcurrent(rdreadopenbrace);inp.readerscope.dig(")").setcurrent(rdreadclosebrace);inp.readerscope.dig("0").setcurrent(rdreadnumber);inp.readerscope.dig("1").setcurrent(rdreadnumber);inp.readerscope.dig("2").setcurrent(rdreadnumber);inp.readerscope.dig("3").setcurrent(rdreadnumber);inp.readerscope.dig("4").setcurrent(rdreadnumber);inp.readerscope.dig("5").setcurrent(rdreadnumber);inp.readerscope.dig("6").setcurrent(rdreadnumber);inp.readerscope.dig("7").setcurrent(rdreadnumber);inp.readerscope.dig("8").setcurrent(rdreadnumber);inp.readerscope.dig("9").setcurrent(rdreadnumber);inp.readerscope.dig("?").setcurrent(rdreadchar);inp.readerscope.dig("@").dig(".").setcurrent(rdreadpre);var synif=new SpecialFunctionClass();var synblock=new SpecialFunctionClass();var synblock_func=new SpecialFunctionClass();var synprogn=new SpecialFunctionClass();var synprogn_func=new SpecialFunctionClass();var synprogn_source=new SpecialFunctionClass();var synand=new SpecialFunctionClass();var synor=new SpecialFunctionClass();var synnot=new SpecialFunctionClass();var synsetf=new SpecialFunctionClass();inp.scope.intern(new StringClass(slice("if").map(atoc))).setfunc(synif);inp.scope.intern(new StringClass(slice("block").map(atoc))).setfunc(synblock);inp.scope.intern(new StringClass(slice("progn").map(atoc))).setfunc(synprogn);inp.scope.intern(new StringClass(slice("and").map(atoc))).setfunc(synand);inp.scope.intern(new StringClass(slice("or").map(atoc))).setfunc(synor);inp.scope.intern(new StringClass(slice("not").map(atoc))).setfunc(synnot);inp.scope.intern(new StringClass(slice("setf").map(atoc))).setfunc(synsetf);synif.label="<#syntax if>";synblock.label="<#syntax block>";synblock_func.label="<#syntax block func>";synprogn.label="<#syntax progn>";synprogn_func.label="<#syntax progn func>";synprogn_source.label="<#syntax progn source>";synand.label="<#syntax and>";synor.label="<#syntax or>";synnot.label="<#syntax not>";synsetf.label="<#syntax setf>";synif.onevaluate=function(c,a,b){if(c.evaluatearg().status()){return a.evaluatearg()}return b.evaluatearg()};synif.onexpand=function(c,a,b){return new Expanded("("+c.expandarg().unpack()+"?"+a.expandarg().unpack()+":"+b.expandarg().unpack()+")")};synblock.onevaluate=function(){inp.nestin();var a=synprogn.evaluate.apply(synprogn,arguments);inp.exitin();return a};synblock.onexpand=function(){inp.nestin();var a=synprogn.expand.apply(synprogn,arguments);inp.exitin();return a};synblock_func.onevaluate=function(){inp.nest();var a=synprogn.evaluate.apply(synprogn,arguments);inp.exit();return a};synblock_func.onexpand=function(){inp.nest();var a=synprogn.evaluate.apply(synprogn,arguments);inp.exit();return a};synprogn.onevaluate=function(){var b,a;for(b=nil,a=0;a<arguments.length;a++){b=arguments[a].evaluatearg()}return b};synprogn.onexpand=function(){var b,a;for(b="",a=0;a<arguments.length;a++){b+=(a?",":"")+arguments[a].expandarg().unpack()}return new Expanded("("+b+")")};synprogn_func.onevaluate=synprogn.onevaluate;synprogn_func.onexpand=function(){var b,a;for(b="",a=0;a<(arguments.length-1);a++){b+=arguments[a].expandarg().unpack()+";"}b+="return "+arguments[a].expandarg().unpack()+";";return new Expanded(b)};synprogn_source.onevaluate=synprogn.onevaluate;synprogn_source.onexpand=function(){var b,a;for(b="",a=0;a<arguments.length;a++){b+=arguments[a].expandarg().unpack()+";"}return new Expanded(b)};synand.onevaluate=function(){var b,a;for(b=nil,a=0;a<arguments.length;a++){if((b=arguments[a].evaluatearg()).status()==false){return nil}}return b};synand.onexpand=function(){return new Expanded("("+slice(arguments).map(expandarg).map(unpack).join("&&")+")")};synor.onevaluate=function(){var b,a;for(b=nil,a=0;a<arguments.length;a++){if((b=arguments[a].evaluatearg())){return b}}return nil};synor.onexpand=function(){return new Expanded("("+slice(arguments).map(expandarg).map(unpack).join("||")+")")};synnot.onevaluate=function(a){return a.evaluatearg().status()?nil:t};synnot.onexpand=function(a){return new Expanded("(!"+a.expandarg().unpack()+")")};synsetf.onevaluate=function(b,a){return b.evaluatearg().set(a.evaluatearg())};synsetf.onexpand=function(b,a){synsetf.evaluate(b,a);return new Expanded(b.evaluatearg().expandarg()+"="+a.evaluatearg().expandarg())};var macwhen=new PrimitiveMacroClass();var macunless=new PrimitiveMacroClass();var maclambda=new PrimitiveMacroClass();var macdefun=new PrimitiveMacroClass();var macmacro=new PrimitiveMacroClass();var macdefmacro=new PrimitiveMacroClass();var macsetq=new PrimitiveMacroClass();var macincf=new PrimitiveMacroClass();var macdecf=new PrimitiveMacroClass();var maclet=new PrimitiveMacroClass();var macflet=new PrimitiveMacroClass();var macmlet=new PrimitiveMacroClass();var macdefvar=new PrimitiveMacroClass();var macdeflvar=new PrimitiveMacroClass();inp.scope.intern(new StringClass(slice("when").map(atoc))).setfunc(macwhen);inp.scope.intern(new StringClass(slice("unless").map(atoc))).setfunc(macunless);inp.scope.intern(new StringClass(slice("lambda").map(atoc))).setfunc(maclambda);inp.scope.intern(new StringClass(slice("defun").map(atoc))).setfunc(macdefun);inp.scope.intern(new StringClass(slice("macro").map(atoc))).setfunc(macmacro);inp.scope.intern(new StringClass(slice("defmacro").map(atoc))).setfunc(macdefmacro);inp.scope.intern(new StringClass(slice("setq").map(atoc))).setfunc(macsetq);inp.scope.intern(new StringClass(slice("incf").map(atoc))).setfunc(macincf);inp.scope.intern(new StringClass(slice("decf").map(atoc))).setfunc(macdecf);inp.scope.intern(new StringClass(slice("let").map(atoc))).setfunc(maclet);inp.scope.intern(new StringClass(slice("flet").map(atoc))).setfunc(macflet);inp.scope.intern(new StringClass(slice("mlet").map(atoc))).setfunc(macmlet);inp.scope.intern(new StringClass(slice("defvar").map(atoc))).setfunc(macdefvar);inp.scope.intern(new StringClass(slice("deflvar").map(atoc))).setfunc(macdeflvar);macincf.onevaluate=function(a){return new ConsClass(synsetf,new ConsClass(a,new ConsClass(new ConsClass(basadd,new ConsClass(a,new ConsClass(new IntClass(1)))))))};macdecf.onevaluate=function(a){return new ConsClass(synsetf,new ConsClass(a,new ConsClass(new ConsClass(bassub,new ConsClass(a,new ConsClass(new IntClass(1)))))))};macdefvar.onevaluate=function(a,b){return new ConsClass(synsetf,new ConsClass(new ConsClass(bassymbolvalue,new ConsClass(new ConsClass(basglobal,new ConsClass(new QuoteClass(a))))),new ConsClass(b)))};macdeflvar.onevaluate=function(a,b){return new ConsClass(synsetf,new ConsClass(new ConsClass(bassymbolvalue,new ConsClass(new ConsClass(baslocal,new ConsClass(new QuoteClass(a))))),new ConsClass(b)))};macwhen.onevaluate=function(a){return new ConsClass(synif,new ConsClass(a,new ConsClass(new ConsClass(synprogn,ConsClass.toCons(slice(arguments,1))),new ConsClass(nil))))};macunless.onevaluate=function(a){return new ConsClass(synif,new ConsClass(a,new ConsClass(nil,new ConsClass(new ConsClass(synprogn,ConsClass.toCons(slice(arguments,1)))))))};maclambda.onevaluate=function(a){return new UserFunctionClass(null,a,new ConsClass(synprogn_func,ConsClass.toCons(slice(arguments,1))))};macdefun.onevaluate=function(a){return new ConsClass(synsetf,new ConsClass(new QuoteClass(new SymbolFunctionReferenceClass(a)),new ConsClass(new ConsClass(maclambda,ConsClass.toCons(slice(arguments,1))))))};macmacro.onevaluate=function(a){return new UserMacroClass(null,a,new ConsClass(synprogn,ConsClass.toCons(slice(arguments,1))))};macdefmacro.onevaluate=function(a){return new ConsClass(synsetf,new ConsClass(new QuoteClass(new SymbolFunctionReferenceClass(a)),new ConsClass(new ConsClass(macmacro,ConsClass.toCons(slice(arguments,1))))))};macsetq.onevaluate=function(a,b){return new ConsClass(synsetf,new ConsClass(new QuoteClass(new SymbolValueReferenceClass(a)),new ConsClass(b)))};maclet.onevaluate=function(c){var a,b;for(a=new ConsClass(synprogn),b=c.iter();b.isalive();){a=new ConsClass(new ConsClass(macdeflvar,b.next()),a)}a=a.reverse();return new ConsClass(synblock,new ConsClass(a,new ConsClass(new ConsClass(synprogn,ConsClass.toCons(slice(arguments,1))))))};macflet.onevaluate=function(c){var a,b,d;for(a=new ConsClass(synprogn),b=c.iter();b.isalive();){d=b.next();a=new ConsClass(new ConsClass(synsetf,new ConsClass(new ConsClass(bassymbolfunction,new ConsClass(new QuoteClass(d.car))),new ConsClass(new ConsClass(maclambda,d.cdr)))),a)}a=a.reverse();return new ConsClass(synblock,new ConsClass(a,new ConsClass(new ConsClass(synprogn,ConsClass.toCons(slice(arguments,1))))))};macmlet.onevaluate=function(c){var a,b,d;for(a=new ConsClass(synprogn),b=c.iter();b.isalive();){d=b.next();a=new ConsClass(new ConsClass(synsetf,new ConsClass(new ConsClass(bassymbolfunction,new ConsClass(new QuoteClass(d.car))),new ConsClass(new ConsClass(macmacro,d.cdr)))),a)}a=a.reverse();return new ConsClass(synblock,new ConsClass(a,new ConsClass(new ConsClass(synprogn,ConsClass.toCons(slice(arguments,1))))))};var basadd=new PrimitiveFunctionClass();var bassub=new PrimitiveFunctionClass();var basmul=new PrimitiveFunctionClass();var basdiv=new PrimitiveFunctionClass();var basmod=new PrimitiveFunctionClass();var basconcat=new PrimitiveFunctionClass();var baslist=new PrimitiveFunctionClass();var bascar=new PrimitiveFunctionClass();var bascdr=new PrimitiveFunctionClass();var bascons=new PrimitiveFunctionClass();var basevery=new PrimitiveFunctionClass();var basmap=new PrimitiveFunctionClass();var basfilter=new PrimitiveFunctionClass();var basreduce=new PrimitiveFunctionClass();var basfindif=new PrimitiveFunctionClass();var baspositionif=new PrimitiveFunctionClass();var bascopy=new PrimitiveFunctionClass();var basreverse=new PrimitiveFunctionClass();var basnreverse=new PrimitiveFunctionClass();var basslice=new PrimitiveFunctionClass();var basnth=new PrimitiveFunctionClass();var baslength=new PrimitiveFunctionClass();var basnull=new PrimitiveFunctionClass();var basreadchar=new PrimitiveFunctionClass();var basreadline=new PrimitiveFunctionClass();var bassymbolname=new PrimitiveFunctionClass();var bassymbolvalue=new PrimitiveFunctionClass();var bassymbolfunction=new PrimitiveFunctionClass();var basintern=new PrimitiveFunctionClass();var basmakesymbol=new PrimitiveFunctionClass();var basfuncall=new PrimitiveFunctionClass();var basapply=new PrimitiveFunctionClass();var basglobal=new PrimitiveFunctionClass();var baslocal=new PrimitiveFunctionClass();inp.scope.intern(new StringClass(slice("concat").map(atoc))).setfunc(basconcat);inp.scope.intern(new StringClass(slice("+").map(atoc))).setfunc(basadd);inp.scope.intern(new StringClass(slice("-").map(atoc))).setfunc(bassub);inp.scope.intern(new StringClass(slice("*").map(atoc))).setfunc(basmul);inp.scope.intern(new StringClass(slice("/").map(atoc))).setfunc(basdiv);inp.scope.intern(new StringClass(slice("%").map(atoc))).setfunc(basmod);inp.scope.intern(new StringClass(slice("car").map(atoc))).setfunc(bascar);inp.scope.intern(new StringClass(slice("cdr").map(atoc))).setfunc(bascdr);inp.scope.intern(new StringClass(slice("list").map(atoc))).setfunc(baslist);inp.scope.intern(new StringClass(slice("cons").map(atoc))).setfunc(bascons);inp.scope.intern(new StringClass(slice("every").map(atoc))).setfunc(basevery);inp.scope.intern(new StringClass(slice("map").map(atoc))).setfunc(basmap);inp.scope.intern(new StringClass(slice("filter").map(atoc))).setfunc(basfilter);inp.scope.intern(new StringClass(slice("reduce").map(atoc))).setfunc(basreduce);inp.scope.intern(new StringClass(slice("find-if").map(atoc))).setfunc(basfindif);inp.scope.intern(new StringClass(slice("position-if").map(atoc))).setfunc(baspositionif);inp.scope.intern(new StringClass(slice("copy").map(atoc))).setfunc(bascopy);inp.scope.intern(new StringClass(slice("reverse").map(atoc))).setfunc(basreverse);inp.scope.intern(new StringClass(slice("nreverse").map(atoc))).setfunc(basnreverse);inp.scope.intern(new StringClass(slice("slice").map(atoc))).setfunc(basslice);inp.scope.intern(new StringClass(slice("nth").map(atoc))).setfunc(basnth);inp.scope.intern(new StringClass(slice("length").map(atoc))).setfunc(baslength);inp.scope.intern(new StringClass(slice("null").map(atoc))).setfunc(basnull);inp.scope.intern(new StringClass(slice("read-char").map(atoc))).setfunc(basreadchar);inp.scope.intern(new StringClass(slice("read").map(atoc))).setfunc(rdread);inp.scope.intern(new StringClass(slice("symbol-name").map(atoc))).setfunc(bassymbolname);inp.scope.intern(new StringClass(slice("symbol-value").map(atoc))).setfunc(bassymbolvalue);inp.scope.intern(new StringClass(slice("symbol-function").map(atoc))).setfunc(bassymbolfunction);inp.scope.intern(new StringClass(slice("intern").map(atoc))).setfunc(basintern);inp.scope.intern(new StringClass(slice("make-symbol").map(atoc))).setfunc(basmakesymbol);inp.scope.intern(new StringClass(slice("funcall").map(atoc))).setfunc(basfuncall);inp.scope.intern(new StringClass(slice("apply").map(atoc))).setfunc(basapply);inp.scope.intern(new StringClass(slice("global").map(atoc))).setfunc(basglobal);inp.scope.intern(new StringClass(slice("local").map(atoc))).setfunc(baslocal);basadd.label="<#primitive +>";bassub.label="<#primitive ->";basmul.label="<#primitive *>";basdiv.label="<#primitive />";basmod.label="<#primitive %>";basconcat.label="<#primitive concat>";baslist.label="<#primitive list>";bascar.label="<#primitive car>";bascdr.label="<#primitive cdr>";bascons.label="<#primitive cons>";basevery.label="<#primitive every>";basmap.label="<#primitive map>";basfilter.label="<#primitive filter>";basreduce.label="<#primitive reduce>";basfindif.label="<#primitive findif>";baspositionif.label="<#primitive positionif>";bascopy.label="<#primitive copy>";basreverse.label="<#primitive reverse>";basnreverse.label="<#primitive nreverse>";basslice.label="<#primitive slice>";basnth.label="<#primitive nth>";baslength.label="<#primitive length>";basnull.label="<#primitive null>";basreadchar.label="<#primitive readchar>";basreadline.label="<#primitive readline>";bassymbolname.label="<#primitive symbolname>";bassymbolvalue.label="<#primitive symbolvalue>";bassymbolfunction.label="<#primitive symbolfunction>";basintern.label="<#primitive intern>";basmakesymbol.label="<#primitive makesymbol>";basfuncall.label="<#primitive funcall>";basapply.label="<#primitive apply>";basglobal.label="<#primitive global>";baslocal.label="<#primitive local>";basglobal.onevaluate=function(a){if(a instanceof InternSymbolClass){return inp.scoperoot.intern(a.name)}return a};baslocal.onevaluate=function(a){if(a instanceof InternSymbolClass){return inp.scope.internf(a.name)}return a};basadd.onevaluate=function(){return slice(arguments).reduce(function(d,c){if(d instanceof NumberClass==false||c instanceof NumberClass==false){throw new Error("argument is not number class.")}return new NumberClass(d.value+c.value)})};bassub.onevaluate=function(){return slice(arguments).reduce(function(d,c){if(d instanceof NumberClass==false||c instanceof NumberClass==false){throw new Error("argument is not number class.")}return new NumberClass(d.value-c.value)})};basmul.onevaluate=function(){return slice(arguments).reduce(function(d,c){if(d instanceof NumberClass==false||c instanceof NumberClass==false){throw new Error("argument is not number class.")}return new NumberClass(d.value*c.value)})};basdiv.onevaluate=function(){return slice(arguments).reduce(function(d,c){if(d instanceof NumberClass==false||c instanceof NumberClass==false){throw new Error("argument is not number class.")}return new NumberClass(d.value/c.value)})};basmod.onevaluate=function(){return slice(arguments).reduce(function(d,c){if(d instanceof NumberClass==false||c instanceof NumberClass==false){throw new Error("argument is not number class.")}return new NumberClass(d.value%c.value)})};basadd.onexpand=function(){return new Expanded("("+slice(arguments).join("+")+")")};bassub.onexpand=function(){return new Expanded("("+slice(arguments).join("-")+")")};basmul.onexpand=function(){return new Expanded("("+slice(arguments).join("*")+")")};basdiv.onexpand=function(){return new Expanded("("+slice(arguments).join("/")+")")};basdiv.onexpmod=function(){return new Expanded("("+slice(arguments).join("%")+")")};basadd.onexpandarg=function(){return new Expanded("function(){Array.prototype.slice(arguments).reduce(function(a,b){return a+b;})")};bassub.onexpandarg=function(){return new Expanded("function(){Array.prototype.slice(arguments).reduce(function(a,b){return a-b;})")};basmul.onexpandarg=function(){return new Expanded("function(){Array.prototype.slice(arguments).reduce(function(a,b){return a*b;})")};basdiv.onexpandarg=function(){return new Expanded("function(){Array.prototype.slice(arguments).reduce(function(a,b){return a/b;})")};basmod.onexpandarg=function(){return new Expanded("function(){Array.prototype.slice(arguments).reduce(function(a,b){return a%b;})")};basconcat.onevaluate=function(){return new StringClass(Array.prototype.concat.apply([],slice(arguments).map(value)))};basconcat.onexpand=function(){return new Expanded("("+slice(arguments).map(expandarg).map(unpack).join("+")+")")};bascar.onevaluate=function(a){return a.car};bascar.onexpand=function(a){return new Expanded(a+"[0]")};bascdr.onevaluate=function(a){return a.cdr};bascdr.onexpand=function(a){return new Expanded(a+".slice(1)")};bascons.onevaluate=function(a,b){return new ConsClass(a,b)};bascons.onexpand=function(a,b){return new Expanded("["+a+"].concat("+b+")")};baslist.onevaluate=function(){return new ConsClass.toCons(slice(arguments))};baslist.onexpand=function(){return new ConsClass.toCons(slice(arguments)).expanddata()};basevery.onevaluate=function(a,b){return b.every(a)};basmap.onevaluate=function(a,b){return b.map(a)};basmap.onexpand=function(a,b){return new Expanded(b+".map("+a+")")};basfilter.onevaluate=function(a,b){return b.filter(a)};basfilter.onexpand=function(a,b){return new Expanded(b+".filter("+a+")")};basreduce.onevaluate=function(a,b){return b.reduce(a)};basreduce.onexpand=function(a,b){return new Expanded(b+".reduce("+a+")")};basfindif.onevaluate=function(a,b){return b.findif(a)};basfindif.onexpand=function(a,b){throw"find-if is not defined yet."};baspositionif.onevaluate=function(a,b){return b.positionif(a)};baspositionif.onexpand=function(a,b){throw"position-if is not defined yet."};basslice.onevaluate=function(c,a,b){return b.slice(c,a)};basslice.onexpand=function(c,a,b){return new Expanded(b+".slice("+c+","+a+")")};basnth.onevaluate=function(a,b){return b.nth(a.value)};basnth.onexpand=function(a,b){throw"nth is not defined yet."};bascopy.onevaluate=function(a){return a.copy()};bascopy.onexpand=function(a){return new Expanded(a+".slice()")};basreverse.onevaluate=function(a){return a.copy().reverse()};basreverse.onexpand=function(a){return new Expanded(a+".slice().reverse()")};basnreverse.onevaluate=function(a){return a.reverse()};basnreverse.onexpand=function(a){return new Expanded(a+".reverse()")};baslength.onevaluate=function(a){return new IntClass(a.length())};baslength.onexpand=function(a){return new Expanded(a+".length")};basnull.onevaluate=function(a){return new BooleanClass(a==nil)};basnull.onexpand=function(a){return new Expanded("("+a+".length==0)")};basreadchar.onevaluate=function(a){return a.get()};bassymbolname.onevaluate=function(a){return a.name.copy()};bassymbolvalue.onevaluate=function(a){return new SymbolValueReferenceClass(a)};bassymbolfunction.onevaluate=function(a){return new SymbolFunctionReferenceClass(a)};basintern.onevaluate=function(a){inp.scope.intern(a);return new InternSymbolClass(a)};basmakesymbol.onevaluate=function(a){return new VariableSymbolClass(a)};basfuncall.onevaluate=function(a){return a.evaluate.apply(a,slice(arguments,1))};basfuncall.onexpand=function(a){return new Expanded(a+"("+slice(arguments,1).join(",")+")")};basapply.onevaluate=function(a,b){return a.evaluate.apply(a,b.toArray())};basapply.onexpand=function(a,b){return new Expanded(a+"("+b.toArray().join(",")+")")};var optconcat=new OptimizeFunctionClass();var optadd=new OptimizeFunctionClass();var optsub=new OptimizeFunctionClass();var optmul=new OptimizeFunctionClass();var optdiv=new OptimizeFunctionClass();var optmod=new OptimizeFunctionClass();inp.scope.intern(new StringClass(slice("concat").map(atoc))).setfunc(optconcat);inp.scope.intern(new StringClass(slice("+").map(atoc))).setfunc(optadd);inp.scope.intern(new StringClass(slice("-").map(atoc))).setfunc(optsub);inp.scope.intern(new StringClass(slice("*").map(atoc))).setfunc(optmul);inp.scope.intern(new StringClass(slice("/").map(atoc))).setfunc(optdiv);inp.scope.intern(new StringClass(slice("%").map(atoc))).setfunc(optmod);optconcat.onevaluate=beforeevaluatearg(basconcat.onevaluate);optconcat.onexpand=function(){if(isoptimizableall(arguments)){return basconcat.expand.apply(basconcat,arguments)}return basconcat.evaluate.apply(basconcat,arguments).constant()};optadd.onevaluate=beforeevaluatearg(basadd.onevaluate);optadd.onexpand=function(){if(isoptimizableall(arguments)){return basconcat.expand.apply(basadd,arguments)}return basconcat.evaluate.apply(basadd,arguments).constant()};optsub.onevaluate=beforeevaluatearg(bassub.onevaluate);optsub.onexpand=function(){if(isoptimizableall(arguments)){return basconcat.expand.apply(bassub,arguments)}return basconcat.evaluate.apply(bassub,arguments).constant()};optmul.onevaluate=beforeevaluatearg(basmul.onevaluate);optmul.onexpand=function(){if(isoptimizableall(arguments)){return basconcat.expand.apply(basmul,arguments)}return basconcat.evaluate.apply(basmul,arguments).constant()};optdiv.onevaluate=beforeevaluatearg(basdiv.onevaluate);optdiv.onexpand=function(){if(isoptimizableall(arguments)){return basconcat.expand.apply(basdiv,arguments)}return basconcat.evaluate.apply(basdiv,arguments).constant()};optmod.onevaluate=beforeevaluatearg(basmod.onevaluate);optmod.onexpand=function(){if(isoptimizableall(arguments)){return basconcat.expand.apply(basmod,arguments)}return basconcat.evaluate.apply(basmod,arguments).constant()};var debprint=new PrimitiveFunctionClass();var debtime=new SpecialFunctionClass();inp.scope.intern(new StringClass(slice("print").map(atoc))).setfunc(debprint);inp.scope.intern(new StringClass(slice("time").map(atoc))).setfunc(debtime);debprint.onevaluate=function(a){console.log(a.toString());return a};debprint.onexpand=function(b){var a=new VariableSymbolClass();return new ConsClass(maclet,new ConsClass(new ConsClass(new ConsClass(a,new ConsClass(b))),new ConsClass(new ConsClass(new Expanded("console.log"),new ConsClass(a))))).expandarg()};debtime.onevaluate=function(){var c;var a;var b;c=Date.now();b=synprogn.evaluate.apply(synprogn,arguments);a=Date.now();console.log("spend time of "+(a-c)+"ms.");return b};